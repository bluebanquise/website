

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6. Configure BlueBanquise &mdash; BlueBanquise Documentation 1.3.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Deploy BlueBanquise" href="deploy_bluebanquise.html" />
    <link rel="prev" title="5. Containers" href="containers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> BlueBanquise Documentation
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="vocabulary.html">2. Vocabulary</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_first_management.html">3. Install first management</a></li>
<li class="toctree-l1"><a class="reference internal" href="learn_ansible.html">4. Learn Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">5. Containers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Configure BlueBanquise</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#get-bluebanquise">6.1. Get BlueBanquise</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-inventory">6.2. Configure inventory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#check-example-inventory">6.2.1. Check example inventory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#review-nodes">6.2.2. Review nodes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#management-node">6.2.2.1. Management node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-nodes">6.2.2.2. Other nodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#review-logical-networks">6.2.3. Review logical networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#review-general-configuration">6.2.4. Review general configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#externals">6.2.4.1. Externals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#network">6.2.4.2. Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#repositories">6.2.4.3. Repositories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nfs">6.2.4.4. NFS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#general">6.2.4.5. General</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#review-default-parameters">6.2.5. Review Default parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#equipment-profile">6.2.5.1. Equipment profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#authentication">6.2.5.2. Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#review-groups-parameters">6.2.6. Review groups parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deploy_bluebanquise.html">7. Deploy BlueBanquise</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple_icebergs.html">8. Manage multiple icebergs</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">9. Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="stories.html">10. Stories</a></li>
<li class="toctree-l1"><a class="reference internal" href="roles.html">11. Roles</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">12. References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BlueBanquise Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">6. </span>Configure BlueBanquise</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/configure_bluebanquise.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configure-bluebanquise">
<h1><span class="section-number">6. </span>Configure BlueBanquise<a class="headerlink" href="#configure-bluebanquise" title="Permalink to this headline">¶</a></h1>
<p>At this point, you should have an operating system with Ansible installed on it,
and basic OS repositories.</p>
<div class="section" id="get-bluebanquise">
<h2><span class="section-number">6.1. </span>Get BlueBanquise<a class="headerlink" href="#get-bluebanquise" title="Permalink to this headline">¶</a></h2>
<p>Install needed basic packages:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>yum install wget createrepo git
</pre></div>
</div>
<p>Now, download latest <strong>BlueBanquise</strong> version from git:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/bluebanquise/bluebanquise.git /etc/bluebanquise
</pre></div>
</div>
<p>ansible will read ANSIBLE_CONFIG, ansible.cfg in the current working directory,
.ansible.cfg in the home directory or /etc/ansible/ansible.cfg, whichever it
finds first.</p>
<p>To use /etc/bluebanquise/ansible.cfg, either change the current working
directory or set ANSIBLE_CONFIG:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ANSIBLE_CONFIG</span><span class="o">=</span>/etc/bluebanquise/ansible.cfg
<span class="nb">cd</span> /etc/bluebanquise
</pre></div>
</div>
<p>Finally, edit /etc/hosts file, and add “management1” (or whatever your current
management node hostname) on localhost line:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 management1
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
</pre></div>
</div>
<p>This will allow us to bootstrap the management configuration.</p>
<p>It is time to configure the inventory to match cluster needs.</p>
</div>
<div class="section" id="configure-inventory">
<h2><span class="section-number">6.2. </span>Configure inventory<a class="headerlink" href="#configure-inventory" title="Permalink to this headline">¶</a></h2>
<p>This documentation will cover the configuration of a very simple cluster:</p>
<img alt="_images/example_cluster_small.svg" src="_images/example_cluster_small.svg" /><div class="section" id="check-example-inventory">
<h3><span class="section-number">6.2.1. </span>Check example inventory<a class="headerlink" href="#check-example-inventory" title="Permalink to this headline">¶</a></h3>
<p>An inventory example is provided in
/etc/bluebanquise/resources/examples/simple_cluster/ as a base for our work.</p>
<p>This example is based on the picture provided just above.</p>
<p>Lets copy it to use it as our new inventory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp -a /etc/bluebanquise/resources/examples/simple_cluster/inventory /etc/bluebanquise/inventory
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Ansible will read <strong>ALL</strong> files in the inventory. <strong>NEVER do a backup of a file
here!</strong>
Backup in another location, outside of /etc/bluebanquise/inventory.</p>
</div>
</div>
<div class="section" id="review-nodes">
<h3><span class="section-number">6.2.2. </span>Review nodes<a class="headerlink" href="#review-nodes" title="Permalink to this headline">¶</a></h3>
<p>Time to review the provided example configuration, and adapt it to your
configuration.</p>
<p>First, the nodes.</p>
<div class="section" id="management-node">
<h4><span class="section-number">6.2.2.1. </span>Management node<a class="headerlink" href="#management-node" title="Permalink to this headline">¶</a></h4>
<p>Open file cluster/nodes/managements.yml:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mg_managements</span><span class="p">:</span>
  <span class="nt">children</span><span class="p">:</span>
    <span class="nt">equipment_typeM</span><span class="p">:</span>
      <span class="nt">hosts</span><span class="p">:</span>
        <span class="nt">management1</span><span class="p">:</span>
          <span class="nt">bmc</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bmanagement1</span>
            <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.100.1</span>
            <span class="nt">mac</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:dc:f8:f6</span>
            <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>
          <span class="nt">network_interfaces</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">enp0s3</span>
              <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
              <span class="nt">mac</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:dc:f8:f5</span>
              <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>
            <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ib0</span>
              <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.20.0.1</span>
              <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">interconnect-1</span>
</pre></div>
</div>
<p>This file contains our management node configuration. Let’s review it, to
understand it.</p>
<p>First, the groups:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mg_managements</span><span class="p">:</span>         <span class="c1"># This is the main group (also called master group), it is very useful with advanced configuration</span>
  <span class="nt">children</span><span class="p">:</span>             <span class="c1"># This is an Ansible instruction, indicating the below group is included in mg_managements group</span>
    <span class="nt">equipment_typeM</span><span class="p">:</span>    <span class="c1"># This is the equipment group of the management node. It always starts by &#39;equipment_&#39;</span>
      <span class="nt">hosts</span><span class="p">:</span>            <span class="c1"># This is an Ansible instruction, to list below the hosts member of this group</span>
        <span class="nt">management1</span><span class="p">:</span>    <span class="c1"># This is the hostname</span>
</pre></div>
</div>
<p>Now the BMC (if exist):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mg_managements</span><span class="p">:</span>
  <span class="nt">children</span><span class="p">:</span>
    <span class="nt">equipment_typeM</span><span class="p">:</span>
      <span class="nt">hosts</span><span class="p">:</span>
        <span class="nt">management1</span><span class="p">:</span>
          <span class="nt">bmc</span><span class="p">:</span>                      <span class="c1"># This instruction defines an attached BMC</span>
            <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bmanagement1</span>      <span class="c1"># This is the hostname of the BMC</span>
            <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.100.1</span>        <span class="c1"># This is the ipv4 of the BMC</span>
            <span class="nt">mac</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:dc:f8:f6</span>  <span class="c1"># This is the MAC hardware address of the BMC (for DHCP)</span>
            <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>         <span class="c1"># This is the logical network this interface is connected to. Logical networks will be seen later.</span>
</pre></div>
</div>
<p>Then the network interfaces and their associated networks:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mg_managements</span><span class="p">:</span>
  <span class="nt">children</span><span class="p">:</span>
    <span class="nt">equipment_typeM</span><span class="p">:</span>
      <span class="nt">hosts</span><span class="p">:</span>
        <span class="nt">management1</span><span class="p">:</span>
          <span class="nt">bmc</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bmanagement1</span>
            <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.100.1</span>
            <span class="nt">mac</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:dc:f8:f6</span>
            <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>
          <span class="nt">network_interfaces</span><span class="p">:</span>         <span class="c1"># This is an instruction, to define bellow all host&#39;s NIC (Network Interface Controllers)</span>
            <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">enp0s3</span>       <span class="c1"># This is the NIC name (&#39;ip a&#39; command to get NIC list)</span>
              <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>          <span class="c1"># This is the expected ipv4 for this NIC</span>
              <span class="nt">mac</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:dc:f8:f5</span>  <span class="c1"># This is the NIC MAC address, for the DHCP</span>
              <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>         <span class="c1"># This is the logical network this NIC is linked to</span>
            <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ib0</span>          <span class="c1"># This is another NIC, not in the dhcp so no MAC is provided</span>
              <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.20.0.1</span>
              <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">interconnect-1</span>
</pre></div>
</div>
<p>It should not be too difficult to understand this file.</p>
</div>
<div class="section" id="other-nodes">
<h4><span class="section-number">6.2.2.2. </span>Other nodes<a class="headerlink" href="#other-nodes" title="Permalink to this headline">¶</a></h4>
<p>Now, review compute and login nodes in their respective
cluster/nodes/computes.yml and cluster/nodes/logins.yml files. Same rules
apply. You can also add more nodes, or if you have for example multiple type
of equipment for computes nodes or login nodes, add another equipment group
this way:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mg_computes</span><span class="p">:</span>
  <span class="nt">children</span><span class="p">:</span>
    <span class="nt">equipment_typeC</span><span class="p">:</span>
      <span class="nt">hosts</span><span class="p">:</span>
        <span class="nt">c001</span><span class="p">:</span>
        <span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
    <span class="nt">equipment_typeD</span><span class="p">:</span>
      <span class="nt">hosts</span><span class="p">:</span>
        <span class="nt">c005</span><span class="p">:</span>
        <span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
    <span class="nt">equipment_typeE</span><span class="p">:</span>
      <span class="nt">hosts</span><span class="p">:</span>
        <span class="nt">c010</span><span class="p">:</span>
        <span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Now, let’s have a look at the logical networks.</p>
</div>
</div>
<div class="section" id="review-logical-networks">
<h3><span class="section-number">6.2.3. </span>Review logical networks<a class="headerlink" href="#review-logical-networks" title="Permalink to this headline">¶</a></h3>
<p>In <strong>BlueBanquise</strong>, nodes are connected together through logical networks. Most
of the time, logical networks will match your physical network, but for advanced
networking, it can be different.</p>
<p>All networks are defined in group_vars/all/general_settings/network.yml file.
In this current example inventory, there are two networks provided:
ice1-1 and interconnect-1.</p>
<p>Before reviewing the file, please read this <strong>IMPORTANT</strong> information: in
<strong>BlueBanquise</strong> there are two kind of networks: administration/management
networks, and the others.</p>
<p>An administration network is used to deploy and manage the nodes. It will be for
example used to run a DHCP server, handle the PXE stack, etc, and also all the
Ansible ssh connections. Administration networks have a strict naming
convention, which by default is: <strong>iceX-Y</strong> with X the iceberg number, and Y the
subnet number in this iceberg X. In our case, we are working on iceberg1
(default when disabling icebergs mechanism), and we only have one subnet, so our
administration network will be ice1-1. If we would need another subnet, its name
would have been ice1-2, etc. Interconnect-1 is not an administration network.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In new versions of the stack, it is now possible to replace the number Y by a
string compatible with [0-9][a-z][A-Z] regex.</p>
</div>
<p>Open file group_vars/all/general_settings/network.yml and let’s check part of
its content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">networks</span><span class="p">:</span>                                             <span class="c1"># This defines the list of networks</span>
  <span class="nt">ice1-1</span><span class="p">:</span>                                             <span class="c1"># Network name</span>
    <span class="nt">subnet</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.0</span>                                 <span class="c1"># Network subnet</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>                                        <span class="c1"># Network prefix</span>
    <span class="nt">netmask</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">255.255.0.0</span>                              <span class="c1"># Network netmask, must comply with prefix</span>
    <span class="nt">broadcast</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.255.255</span>                          <span class="c1"># Broadcast, deduced from subnet and prefix/netmask</span>
    <span class="nt">dhcp_unknown_range</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.254.1 10.10.254.254</span>     <span class="c1"># This is the range of ip where unknown nodes (i.e. not in the inventory) will be placed if asking for an ip</span>
    <span class="nt">gateway</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>                                <span class="c1"># Optional, define a gateway</span>
    <span class="nt">is_in_dhcp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>                                  <span class="c1"># If you want this network to be in the dhcp (only apply to management networks)</span>
    <span class="nt">is_in_dns</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>                                   <span class="c1"># If you want this network to be in the dns</span>
    <span class="nt">services_ip</span><span class="p">:</span>                                      <span class="c1"># IPs or virtual IPs to bind to for each service. In our case, all services will be running on management1 so 10.10.0.1 for all</span>
      <span class="nt">pxe_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">dns_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">repository_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">authentication_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">time_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">log_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
</pre></div>
</div>
<p>All explanations are given above.</p>
<p>One note about <em>services_ip</em>: it is used if services are spread over multiple
managements, or in case of High Availability with virtual IPs. Ansible is not
able to gather this information alone from playbooks (it could, but this would
end up with a way too much complex stack), and so we have to provide it manually.
You can also set here an IP address from another subnet if your system has network
routing.</p>
<p>Then check content of file group_vars/all/networks/interconnect-1.yml . As this
is <strong>not</strong> an administration network, its configuration is easy.</p>
<p>That is all for basic networking. General network parameters are set in
group_vars/all/general_settings/network.yml file, and nodes parameters are
defined in the node’s files.</p>
<p>Now, let’s have a look at the general configuration.</p>
</div>
<div class="section" id="review-general-configuration">
<h3><span class="section-number">6.2.4. </span>Review general configuration<a class="headerlink" href="#review-general-configuration" title="Permalink to this headline">¶</a></h3>
<p>General configuration is made in group_vars/all/general_settings.</p>
<div class="section" id="externals">
<h4><span class="section-number">6.2.4.1. </span>Externals<a class="headerlink" href="#externals" title="Permalink to this headline">¶</a></h4>
<p>File group_vars/all/general_settings/external.yml allows to configure external
resources. It should be self understandable.</p>
</div>
<div class="section" id="network">
<h4><span class="section-number">6.2.4.2. </span>Network<a class="headerlink" href="#network" title="Permalink to this headline">¶</a></h4>
<p>File group_vars/all/general_settings/network.yml allows to configure network
related parameters, and detail all networks of the cluster.</p>
</div>
<div class="section" id="repositories">
<h4><span class="section-number">6.2.4.3. </span>Repositories<a class="headerlink" href="#repositories" title="Permalink to this headline">¶</a></h4>
<p>File group_vars/all/general_settings/repositories.yml configure repositories to
use for all nodes (using groups and variable precedence, repositories can be
tuned for each group of nodes, or even each node).</p>
<p>Right now, only <em>os</em> and <em>bluebanquise</em> are set. This means two or three
(depending of the operating system) repositories will be added to nodes, and
they will bind to repository_ip in ice1-1.yml .</p>
<p>See the repositories_client role part of the documentation for advanced
configurations.</p>
</div>
<div class="section" id="nfs">
<h4><span class="section-number">6.2.4.4. </span>NFS<a class="headerlink" href="#nfs" title="Permalink to this headline">¶</a></h4>
<p>File group_vars/all/general_settings/nfs.yml allows to set NFS shared folders
inside the cluster. Comments in the file should be enough to understand this
file.</p>
</div>
<div class="section" id="general">
<h4><span class="section-number">6.2.4.5. </span>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h4>
<p>File group_vars/all/general_settings/general.yml configure few main parameters:</p>
<ul class="simple">
<li><p>Time zone (very important)</p></li>
</ul>
<p>Do not bother about the other parameters.</p>
<p>And that is all for general configuration. Finally, let’s check the default
parameters.</p>
</div>
</div>
<div class="section" id="review-default-parameters">
<h3><span class="section-number">6.2.5. </span>Review Default parameters<a class="headerlink" href="#review-default-parameters" title="Permalink to this headline">¶</a></h3>
<p>Last part, and probably the most complicated, are default parameters.</p>
<p>Remember Ansible precedence mechanism. All variables in group_vars/all/ have
less priority, while variables in group_vars/* have a higher priority.</p>
<p>The idea here is the following: group_vars/all/equipment_all/ folder contains
all the default parameters for all nodes. Here authentication, and
equipment_profile. You have to tune these parameters to match your exact
“global” need, and then copy (if needed) these whole files into dedicated
group_vars folder for each equipment group, and tune them according to these
equipment specific parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can copy the whole equipment_profile.yml content from equipment_all to
equipment_X folders, <strong>or better</strong>, create a new file in equipment_X and only
set the parameters that are different from the global parameters.</p>
</div>
<p>For example, open file
/etc/bluebanquise/inventory/group_vars/all/equipment_all/equipment_profile.yml,
and check access_control variable. It is set to enforcing:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ep_access_control</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">enforcing</span>
</pre></div>
</div>
<p>Ok, but so all nodes will get this value. Let’s check computes nodes, that are
in equipment_typeC group. Let’s check c001:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>root@<span class="o">]</span><span class="c1"># ansible-inventory --host c001 --yaml | grep ep_access_control</span>
  ep_access_control: enforcing
<span class="o">[</span>root@<span class="o">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>Not good, we want to disable access_control on computes. We need to change that.</p>
<p>Open file group_vars/equipment_typeC/equipment_profile.yml and set
access_control to disabled.</p>
<p>Now check again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>root@<span class="o">]</span><span class="c1"># ansible-inventory --host c001 --yaml | grep ep_access_control</span>
  ep_access_control: disabled
<span class="o">[</span>root@<span class="o">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>Same apply for all equipment_profile parameters. You define a global set of
parameters in equipment_all, which act as a global/default set, and then copy
(all or a part of them) and tune this set for each equipment group if needed.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>IMPORTANT</strong>: equipment_profile variables and authentication variables are
not standard. It is <strong>STRICTLY FORBIDDEN</strong> to tune them outside default
(group_vars/all/equipment_all/equipment_profile.yml) or an equipment group
(group_vars/equipment_*). For example, you cannot create a custom group and
define some equipment_profile parameters for this group. If you really need to
do that, add more equipment groups and tune this way. If you do not respect this
rule, unexpected behavior will happen during configuration deployment.</p>
</div>
<div class="section" id="equipment-profile">
<h4><span class="section-number">6.2.5.1. </span>Equipment profile<a class="headerlink" href="#equipment-profile" title="Permalink to this headline">¶</a></h4>
<p>Equipment profiles are variables dedicated to groups of nodes equipment. These
variables cover most of the hardware, operating system, PXE needs, etc. of the
related nodes.</p>
<p>Lets review them:</p>
<div class="section" id="pxe">
<h5><span class="section-number">6.2.5.1.1. </span>PXE<a class="headerlink" href="#pxe" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><dl class="simple">
<dt><strong>ep_ipxe_driver</strong></dt><dd><ul>
<li><dl class="simple">
<dt>Possible values:</dt><dd><ul>
<li><p>default</p></li>
<li><p>snp</p></li>
<li><p>snponly</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Notes:
See <a class="reference external" href="https://ipxe.org/appnote/buildtargets">https://ipxe.org/appnote/buildtargets</a>.
Most of servers should accept default driver, but snp or snponly can be required on some (with many NICs for example).</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_ipxe_platform</strong></dt><dd><ul>
<li><dl class="simple">
<dt>Possible values:</dt><dd><ul>
<li><p>pcbios</p></li>
<li><p>efi</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Notes:
This is the BIOS firmware type.
Should be detected automatically, but some roles need to force it.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_ipxe_embed</strong></dt><dd><ul>
<li><dl class="simple">
<dt>Possible values:</dt><dd><ul>
<li><p>standard</p></li>
<li><p>dhcpretry</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Notes:
standard is ok for most cases. dhcpretry is to be used on networks where
link on switch may take some time to go up. In dhcpretry mode, the iPXE rom
will indefinitely try to get an ip from the dhcp.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_preserve_efi_first_boot_device</strong></dt><dd><ul>
<li><dl class="simple">
<dt>Possible values:</dt><dd><ul>
<li><p>true</p></li>
<li><p>false</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Notes:
Try to force grub to restore EFI boot order during OS deployment. Allows to
keep PXE first for example.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_console</strong></dt><dd><ul>
<li><p>Notes:
Custom value: the server console to be used. For example: console=tty0 console=ttyS1,115200n8</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_kernel_parameters</strong></dt><dd><ul>
<li><p>Notes:
Custom value: additional kernel parameters to be added on kernel line.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_access_control</strong></dt><dd><ul>
<li><dl class="simple">
<dt>Possible values:</dt><dd><ul>
<li><p>enforcing</p></li>
<li><p>permissive</p></li>
<li><p>disabled</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Notes:
Activate or not the access control (SELinux, etc.).</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_firewall</strong></dt><dd><ul>
<li><dl class="simple">
<dt>Possible values:</dt><dd><ul>
<li><p>true</p></li>
<li><p>false</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Notes:
Activate or not the firewall (firewalld, etc.).</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_partitioning</strong></dt><dd><ul>
<li><p>Notes:
Custom value: contains the partitioning multiple lines to be used. It is
expected here native distribution syntax. For example, for RHEL/CentOS, use
plain kickstart partitioning syntax (allows full custom partitioning).</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_autoinstall_pre_script</strong></dt><dd><ul>
<li><p>Notes:
To add a multiple lines %pre script in the auto deployment file (kickstart,
autoyast, preseed, etc.)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_autoinstall_post_script</strong></dt><dd><ul>
<li><p>Notes:
To add a multiple lines %post script in the auto deployment file (kickstart,
autoyast, preseed, etc.)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_operating_system</strong></dt><dd><ul>
<li><dl class="simple">
<dt><strong>distribution</strong></dt><dd><ul>
<li><p>Notes:
Custom value: set the distribution to be used here. This will be
directly related to the repository used. Standard values are: centos,
redhat, debian, ubuntu, opensuse, etc.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>distribution_major_version</strong></dt><dd><ul>
<li><p>Notes:
Custom value: set the distribution major version number or string.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>distribution_version</strong></dt><dd><ul>
<li><p>Notes:
Custom and optional value: set the distribution minor/custom version to
be used. This will force repositories and PXE to use a minor version
instead of relying on a major.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>repositories_environment</strong></dt><dd><ul>
<li><p>Notes:
Custom and optional value: set a production environment, to prepend all
paths to be used (see repositories_client role documentation). For
example: production, staging, test, etc.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_equipment_type</strong></dt><dd><ul>
<li><dl class="simple">
<dt>Possible values:</dt><dd><ul>
<li><p>server</p></li>
<li><p>any other custom values but not “server”</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Notes:
If server, then PXE files will be generated by the pxe_stack role. If not,
then value can be custom (and no PXE files will be generated).</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_configuration</strong></dt><dd><ul>
<li><dl class="simple">
<dt>keyboard_layout**</dt><dd><ul>
<li><dl class="simple">
<dt>Possible values:</dt><dd><ul>
<li><p>us</p></li>
<li><p>fr</p></li>
<li><p>etc.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Notes:
Set the keyboard layout.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>system_language**</dt><dd><ul>
<li><dl class="simple">
<dt>Possible values:</dt><dd><ul>
<li><p>en_US.UTF-8</p></li>
<li><p>etc.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Notes:
Set the system locals. It is strongly recommended to keep en_US.UTF-8.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_hardware</strong></dt><dd><ul>
<li><p>Notes:
Multiple fields to define system architecture. Some addon roles (like slurm)
may rely on these values.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>ep_equipment_authentication</strong></dt><dd><ul>
<li><dl class="simple">
<dt><strong>user</strong></dt><dd><ul>
<li><p>Notes:
Custom value: set the BMC, storage bay controller, switch, etc. user.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>password</strong></dt><dd><ul>
<li><p>Notes:
Custom value: set the BMC, storage bay controller, switch, etc. password.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="authentication">
<h4><span class="section-number">6.2.5.2. </span>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h4>
<p>Authentication file allows to define default root password for all nodes, and
default public ssh keys lists.</p>
<p>To generate an sha512 password, use the following command (python &gt;3.3):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>python -c &#39;import crypt,getpass; print(crypt.crypt(getpass.getpass(), crypt.mksalt(crypt.METHOD_SHA512)))&#39;
</pre></div>
</div>
<p>We need to ensure our management1 node ssh public key is set here.</p>
<p>Get the content of /root/.ssh/id_rsa.pub and add it in this file. At the same
time, <strong>remove the ssh key provided here as example</strong>.</p>
<p>It is possible to do it automatically using the following command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Copy public key of the mgmt to the inventory
/usr/bin/sed -i -e &quot;s#- ssh-rsa.*#- $(cat /root/.ssh/id_rsa.pub)#&quot; \
  /etc/bluebanquise/inventory/group_vars/all/equipment_all/authentication.yml
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you update the managements ssh keys, do not forget to update this file.</p>
</div>
</div>
</div>
<div class="section" id="review-groups-parameters">
<h3><span class="section-number">6.2.6. </span>Review groups parameters<a class="headerlink" href="#review-groups-parameters" title="Permalink to this headline">¶</a></h3>
<p>Last step is to check and review example of equipment_profile tuning in each of
the group_vars/equipment_XXXXXX folders. Adapt them to your needs.</p>
<p>If you prefer, you can copy the whole
group_vars/all/equipment_all/equipment_profile.yml file into these folders, or
simply adjust the parameters you wish to change from default.</p>
<p>Once done, configuration is ready.</p>
<p>It is time to deploy configuration on management1.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="deploy_bluebanquise.html" class="btn btn-neutral float-right" title="7. Deploy BlueBanquise" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="containers.html" class="btn btn-neutral float-left" title="5. Containers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Benoît Leveugle, Johnny Keats

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>