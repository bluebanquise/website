

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>11. Roles &mdash; BlueBanquise Documentation 1.3.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="12. References" href="references.html" />
    <link rel="prev" title="10. Stories" href="stories.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> BlueBanquise Documentation
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="vocabulary.html">2. Vocabulary</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_first_management.html">3. Install first management</a></li>
<li class="toctree-l1"><a class="reference internal" href="learn_ansible.html">4. Learn Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">5. Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure_bluebanquise.html">6. Configure BlueBanquise</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_bluebanquise.html">7. Deploy BlueBanquise</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple_icebergs.html">8. Manage multiple icebergs</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">9. Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="stories.html">10. Stories</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">11. Roles</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#core">11.1. CORE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#access-control">11.1.1. Access control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#description">11.1.1.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#instructions">11.1.1.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#input">11.1.1.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#output">11.1.1.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#to-be-added">11.1.1.5. To be added</a></li>
<li class="toctree-l4"><a class="reference internal" href="#changelog">11.1.1.6. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#bluebanquise">11.1.2. BlueBanquise</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">11.1.2.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">11.1.2.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">11.1.2.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">11.1.2.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">11.1.2.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#conman">11.1.3. Conman</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">11.1.3.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">11.1.3.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">11.1.3.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">11.1.3.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">11.1.3.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#display-tuning">11.1.4. Display_tuning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">11.1.4.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">11.1.4.2. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">11.1.4.3. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">11.1.4.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dhcp-server">11.1.5. DHCP server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id15">11.1.5.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">11.1.5.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">11.1.5.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id18">11.1.5.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id19">11.1.5.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dns-server">11.1.6. DNS server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id20">11.1.6.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">11.1.6.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id22">11.1.6.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id23">11.1.6.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id24">11.1.6.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dns-client">11.1.7. DNS client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id25">11.1.7.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id26">11.1.7.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id27">11.1.7.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id28">11.1.7.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id29">11.1.7.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#firewall">11.1.8. Firewall</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id30">11.1.8.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id31">11.1.8.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id32">11.1.8.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id33">11.1.8.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id34">11.1.8.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#hosts-file">11.1.9. Hosts file</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id35">11.1.9.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id36">11.1.9.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id37">11.1.9.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id38">11.1.9.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id39">11.1.9.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#log-server">11.1.10. Log server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id40">11.1.10.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id41">11.1.10.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id42">11.1.10.3. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#log-client">11.1.11. Log client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id43">11.1.11.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id44">11.1.11.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#to-be-done">11.1.11.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id45">11.1.11.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#nfs-server">11.1.12. NFS server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id46">11.1.12.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id47">11.1.12.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id48">11.1.12.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id49">11.1.12.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id50">11.1.12.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#nfs-client">11.1.13. NFS client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id51">11.1.13.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id52">11.1.13.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id53">11.1.13.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id54">11.1.13.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id55">11.1.13.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#nic">11.1.14. NIC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id56">11.1.14.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id57">11.1.14.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id58">11.1.14.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id59">11.1.14.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#pxe-stack">11.1.15. PXE Stack</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id60">11.1.15.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id61">11.1.15.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-parameters">11.1.15.3. Optional parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id63">11.1.15.4. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id64">11.1.15.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#repositories-server">11.1.16. Repositories server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id65">11.1.16.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id66">11.1.16.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id67">11.1.16.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id68">11.1.16.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id69">11.1.16.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#repositories-client">11.1.17. Repositories client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id70">11.1.17.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id71">11.1.17.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id72">11.1.17.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id73">11.1.17.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id74">11.1.17.5. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id75">11.1.17.6. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#set-hostname">11.1.18. Set Hostname</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id76">11.1.18.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id77">11.1.18.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id78">11.1.18.3. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ssh-master">11.1.19. SSH master</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id79">11.1.19.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id80">11.1.19.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id81">11.1.19.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id82">11.1.19.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id83">11.1.19.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ssh-slave">11.1.20. SSH slave</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id84">11.1.20.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id85">11.1.20.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id86">11.1.20.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id87">11.1.20.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id88">11.1.20.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#time-server">11.1.21. Time server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id89">11.1.21.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id90">11.1.21.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id91">11.1.21.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id92">11.1.21.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id93">11.1.21.5. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id94">11.1.21.6. Changelog</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-core">11.2. ADVANCED CORE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#advanced-dhcp-server">11.2.1. Advanced DHCP server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id95">11.2.1.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id96">11.2.1.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id97">11.2.1.3. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-dns-server">11.2.2. Advanced DNS server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id98">11.2.2.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id99">11.2.2.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id100">11.2.2.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id101">11.2.2.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id102">11.2.2.5. Changelog</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#addons">11.3. ADDONS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cloning">11.3.1. Cloning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id103">11.3.1.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id104">11.3.1.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id105">11.3.1.3. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#clustershell">11.3.2. ClusterShell</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id106">11.3.2.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id107">11.3.2.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id108">11.3.2.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id109">11.3.2.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#diskless">11.3.3. Diskless</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id110">11.3.3.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basic-instructions">11.3.3.2. Basic instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-livenet-image">11.3.3.3. Customizing Livenet image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-playbook">11.3.3.4. Example Playbook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id111">11.3.3.5. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id112">11.3.3.6. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ofed">11.3.4. OFED</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id113">11.3.4.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id114">11.3.4.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id115">11.3.4.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id116">11.3.4.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ofed-sm">11.3.5. OFED_SM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id117">11.3.5.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id118">11.3.5.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id119">11.3.5.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id120">11.3.5.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#openldap-client">11.3.6. OpenLDAP client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id121">11.3.6.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id122">11.3.6.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id123">11.3.6.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id124">11.3.6.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#openldap-server">11.3.7. OpenLDAP server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id125">11.3.7.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id126">11.3.7.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id127">11.3.7.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id128">11.3.7.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#nic-with-nmcli">11.3.8. NIC with nmcli</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id129">11.3.8.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id130">11.3.8.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id131">11.3.8.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id132">11.3.8.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#powerman">11.3.9. Powerman</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id133">11.3.9.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id134">11.3.9.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id135">11.3.9.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id136">11.3.9.4. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id137">11.3.9.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#prometheus-server">11.3.10. Prometheus server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id138">11.3.10.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id139">11.3.10.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id140">11.3.10.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id141">11.3.10.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#prometheus-client">11.3.11. Prometheus client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id142">11.3.11.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id143">11.3.11.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id144">11.3.11.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id145">11.3.11.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#grafana">11.3.12. Grafana</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id146">11.3.12.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id147">11.3.12.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id148">11.3.12.3. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#report">11.3.13. Report</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id149">11.3.13.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id150">11.3.13.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id151">11.3.13.3. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id152">11.3.13.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#root-password">11.3.14. Root password</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id153">11.3.14.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id154">11.3.14.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id155">11.3.14.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id156">11.3.14.4. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#singularity">11.3.15. Singularity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id157">11.3.15.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pre-requisites">11.3.15.2. Pre-requisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">11.3.15.3. Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id158">11.3.15.4. ChangeLog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sssd">11.3.16. SSSD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id159">11.3.16.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id160">11.3.16.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id161">11.3.16.3. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#slurm">11.3.17. Slurm</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id162">11.3.17.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id163">11.3.17.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id164">11.3.17.3. Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id165">11.3.17.4. To be done</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id166">11.3.17.5. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#users-basic">11.3.18. Users basic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id167">11.3.18.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id168">11.3.18.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id169">11.3.18.3. Changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lmod">11.3.19. lmod</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id170">11.3.19.1. Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id171">11.3.19.2. Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id172">11.3.19.3. Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id173">11.3.19.4. Changelog</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="references.html">12. References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BlueBanquise Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">11. </span>Roles</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/roles.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="roles">
<h1><span class="section-number">11. </span>Roles<a class="headerlink" href="#roles" title="Permalink to this headline">¶</a></h1>
<p>This part is an agregations of all the <strong>BlueBanquise</strong> roles readme.</p>
<div class="section" id="core">
<h2><span class="section-number">11.1. </span>CORE<a class="headerlink" href="#core" title="Permalink to this headline">¶</a></h2>
<div class="section" id="access-control">
<h3><span class="section-number">11.1.1. </span>Access control<a class="headerlink" href="#access-control" title="Permalink to this headline">¶</a></h3>
<div class="section" id="description">
<h4><span class="section-number">11.1.1.1. </span>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h4>
<p>This role ensure the node current status comply with
ep_access_control variable.</p>
</div>
<div class="section" id="instructions">
<h4><span class="section-number">11.1.1.2. </span>Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h4>
<p>None</p>
</div>
<div class="section" id="input">
<h4><span class="section-number">11.1.1.3. </span>Input<a class="headerlink" href="#input" title="Permalink to this headline">¶</a></h4>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>ep_access_control</p></li>
</ul>
</div>
<div class="section" id="output">
<h4><span class="section-number">11.1.1.4. </span>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h4>
<p>Set SELinux, AppArmor, etc status.</p>
</div>
<div class="section" id="to-be-added">
<h4><span class="section-number">11.1.1.5. </span>To be added<a class="headerlink" href="#to-be-added" title="Permalink to this headline">¶</a></h4>
<p>Check if no packages are needed when enforcing after a selinux –disabled
kickstart.</p>
</div>
<div class="section" id="changelog">
<h4><span class="section-number">11.1.1.6. </span>Changelog<a class="headerlink" href="#changelog" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="bluebanquise">
<h3><span class="section-number">11.1.2. </span>BlueBanquise<a class="headerlink" href="#bluebanquise" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4><span class="section-number">11.1.2.1. </span>Description<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>This role install Ansible and dependencies on BlueBanquise controllers.
Mainly used for bootstrapping the stack or multi iceberg.</p>
</div>
<div class="section" id="id2">
<h4><span class="section-number">11.1.2.2. </span>Instructions<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>None</p>
</div>
<div class="section" id="id3">
<h4><span class="section-number">11.1.2.3. </span>Input<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>None</p>
</div>
<div class="section" id="id4">
<h4><span class="section-number">11.1.2.4. </span>Output<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Packages installed:</p>
<ul class="simple">
<li><p>ansible</p></li>
<li><p>python netaddr and jmespath</p></li>
</ul>
</div>
<div class="section" id="id5">
<h4><span class="section-number">11.1.2.5. </span>Changelog<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.2: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Add Ansible dependencies for additional filters. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="conman">
<h3><span class="section-number">11.1.3. </span>Conman<a class="headerlink" href="#conman" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id6">
<h4><span class="section-number">11.1.3.1. </span>Description<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>This role provides a conman daemon that logs ipmi serial consoles.</p>
</div>
<div class="section" id="id7">
<h4><span class="section-number">11.1.3.2. </span>Instructions<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>To login into a console, use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conman mynode
</pre></div>
</div>
<p>To exit, simply press <strong>&amp;</strong> then <strong>.</strong> .</p>
</div>
<div class="section" id="id8">
<h4><span class="section-number">11.1.3.3. </span>Input<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>icebergs_system</p></li>
</ul>
<p><strong>hostvars[hosts]</strong></p>
<ul class="simple">
<li><p>ep_equipment_type (triggers if == “server”)</p></li>
<li><p>ep_equipment_authentication.user</p></li>
<li><p>ep_equipment_authentication.password</p></li>
<li><dl class="simple">
<dt>bmc</dt><dd><ul>
<li><p>.ip4</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id9">
<h4><span class="section-number">11.1.3.4. </span>Output<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>Packages installed:</p>
<ul class="simple">
<li><p>conman</p></li>
<li><p>ipmitool</p></li>
</ul>
<p>Files generated:</p>
<ul class="simple">
<li><p>/etc/conman.conf</p></li>
</ul>
</div>
<div class="section" id="id10">
<h4><span class="section-number">11.1.3.5. </span>Changelog<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.3: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.2: Tested on ubuntu 18.04 and validated. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="display-tuning">
<h3><span class="section-number">11.1.4. </span>Display_tuning<a class="headerlink" href="#display-tuning" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id11">
<h4><span class="section-number">11.1.4.1. </span>Description<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>This role provides some nice colors and screenrc.</p>
</div>
<div class="section" id="id12">
<h4><span class="section-number">11.1.4.2. </span>Input<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>None</p>
</div>
<div class="section" id="id13">
<h4><span class="section-number">11.1.4.3. </span>Output<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>Files generated:</p>
<ul class="simple">
<li><p>/usr/bin/free_root_disk</p></li>
<li><p>/root/.screenrc</p></li>
<li><p>/root/.vimrc</p></li>
</ul>
<p>Files modified:</p>
<ul class="simple">
<li><p>/root/.bashrc</p></li>
</ul>
</div>
<div class="section" id="id14">
<h4><span class="section-number">11.1.4.4. </span>Changelog<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.1: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="dhcp-server">
<h3><span class="section-number">11.1.5. </span>DHCP server<a class="headerlink" href="#dhcp-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id15">
<h4><span class="section-number">11.1.5.1. </span>Description<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>This role provides a standard and simple dhcp server combined with the iPXE roms of BlueBanquise.
It should be enough for most networks.</p>
<p>Please use advanced version if you need advanced features like shared-networks,
opt61/82 match, or need to force iPXE roms to be used, or use advanced iPXE driver.</p>
</div>
<div class="section" id="id16">
<h4><span class="section-number">11.1.5.2. </span>Instructions<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>This role provides basic features for network relying on MAC only (or range of unknown hosts).</p>
<p>The role will only take into account networks from the current iceberg,
and with naming related to administration network (by default iceX-Y).
In single iceberg configuration, i.e. default, it will consider ice1-Y networks.</p>
<p>For a network to be included in the dhcp,
the variable <strong>is_in_dhcp</strong> must be set to true in the related network configuration.</p>
<p>Note also that dhcp role will use the following optional parameters if they exist in network:</p>
<ul class="simple">
<li><p>dhcp_unknown_range: define the range of the subnet, for unregistered hosts.
Can be useful for temporary connections (laptops, etc) or to detect if an
hardware is missing in the inventory.</p></li>
<li><p>gateway: define router in the subnet, and so gateway provided by the dhcp server.</p></li>
</ul>
<p>Resulting example network could be:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">networks</span><span class="p">:</span>
  <span class="nt">ice1-1</span><span class="p">:</span>
    <span class="nt">subnet</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.0</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">netmask</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">255.255.0.0</span>
    <span class="nt">broadcast</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.255.255</span>
    <span class="nt">dhcp_unknown_range</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.254.1 10.11.254.254</span>  <span class="c1"># Is optional</span>
    <span class="nt">gateway</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.2.1</span>                             <span class="c1"># Is optional</span>
    <span class="nt">is_in_dhcp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>                               <span class="c1"># Must be set to true for dhcp role to integrate this network</span>
    <span class="nt">is_in_dns</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">services_ip</span><span class="p">:</span>
      <span class="nt">pxe_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.1</span>                            <span class="c1"># Will be used by dhcp for next server</span>
      <span class="nt">dns_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.1</span>                            <span class="c1"># Will be used by dhcp for dns server</span>
      <span class="nt">repository_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.1</span>
      <span class="nt">authentication_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.1</span>
      <span class="nt">time_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.1</span>                           <span class="c1"># Will be used by dhcp for time server</span>
      <span class="nt">log_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.1</span>
</pre></div>
</div>
<p>Finally, note that the following parameters can be set in the inventory, to
override default ones:</p>
<ul class="simple">
<li><p>dhcp_server_default_lease_time (default to 600)</p></li>
<li><p>dhcp_server_max_lease_time (default to 7200)</p></li>
</ul>
<p>Consider increasing the default values once your network is production ready.</p>
</div>
<div class="section" id="id17">
<h4><span class="section-number">11.1.5.3. </span>Input<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>icebergs_system</p></li>
<li><p>domain_name</p></li>
<li><dl class="simple">
<dt>network[item]</dt><dd><ul>
<li><p>.is_in_dhcp (triggers if == “true”)</p></li>
<li><p>.subnet</p></li>
<li><p>.netmask</p></li>
<li><p>.broadcast</p></li>
<li><p>.services_ip.pxe_ip</p></li>
<li><p>.services_ip.dns_ip</p></li>
<li><p>.services_ip.time_ip</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>hostvars[hosts]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>network_interfaces</dt><dd><ul>
<li><p>.ip4</p></li>
<li><p>.mac</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>dhcp_server_default_lease_time</p></li>
<li><p>dhcp_server_max_lease_time</p></li>
<li><dl class="simple">
<dt>network[item]</dt><dd><ul>
<li><p>.dhcp_unknown_range</p></li>
<li><p>.gateway</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>hostvars[hosts]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>bmc</dt><dd><ul>
<li><p>.ip4</p></li>
<li><p>.mac</p></li>
<li><p>.name</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id18">
<h4><span class="section-number">11.1.5.4. </span>Output<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<p>Packages installed:</p>
<ul class="simple">
<li><p>dhcp server</p></li>
</ul>
<p>Files generated:</p>
<ul class="simple">
<li><p>/etc/dhcp/dhcpd.conf</p></li>
<li><p>/etc/dhcp/dhcpd.networks.conf</p></li>
<li><p>/etc/dhcp/dhcpd.{{ network }}.conf</p></li>
</ul>
</div>
<div class="section" id="id19">
<h4><span class="section-number">11.1.5.5. </span>Changelog<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.7: Set defaults leases. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.6: Update to new network_interfaces syntax. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.5: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.4: Added support of multiple DNS servers. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.0.3: Simplify standard dhcp, create advanced dhcp for complex configurations. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.2: Added Ubuntu 18.04 compatibility. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="dns-server">
<h3><span class="section-number">11.1.6. </span>DNS server<a class="headerlink" href="#dns-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id20">
<h4><span class="section-number">11.1.6.1. </span>Description<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>This role provides a basic dns server based on bind.</p>
<p>Warning: this dns server is designed to be used as a single dns for the whole
cluster. If you need multiple dns servers in the same cluster, or replication,
please use the advanced dns server role instead.</p>
</div>
<div class="section" id="id21">
<h4><span class="section-number">11.1.6.2. </span>Instructions<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<p>This DNS role will automatically add all networks of the cluster, assuming their
variable <strong>is_in_dns</strong> is set to true:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">networks</span><span class="p">:</span>
  <span class="nt">ice1-1</span><span class="p">:</span>
    <span class="nt">subnet</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.0</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">netmask</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">255.255.0.0</span>
    <span class="nt">broadcast</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.255.255</span>
    <span class="nt">is_in_dhcp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">is_in_dns</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
    <span class="nt">services_ip</span><span class="p">:</span>
      <span class="nt">dns_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.1</span>
</pre></div>
</div>
<p>It will generate 5 files:</p>
<ul class="simple">
<li><p>/etc/named.conf that contains main configuration, and that will try to bind to all networks defined on the host it is deployed on, using <strong>services_ip.dns_ip</strong> variable ip of the network.</p></li>
<li><p>/var/named/forward that contains forward resolution of hosts</p></li>
<li><p>/var/named/forward.soa included by /var/named/forward</p></li>
<li><p>/var/named/reverse that contains reverse resolution of hosts</p></li>
<li><p>/var/named/reverse.soa included by /var/named/reverse</p></li>
</ul>
<p>To configure forwarding and integrate this dns server into an existing IT
configuration, use file <em>group_vars/all/general_settings/external.yml</em>.
It is possible to add here an external dns to bind to for this internal dns, as
a relay.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">external_dns</span><span class="p">:</span>
  <span class="nt">dns_server</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
    <span class="l l-Scalar l-Scalar-Plain">- 208.67.222.222</span>
</pre></div>
</div>
</div>
<div class="section" id="id22">
<h4><span class="section-number">11.1.6.3. </span>Input<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>domain_name</p></li>
<li><dl class="simple">
<dt>network[item]</dt><dd><ul>
<li><p>.services_ip.dns_ip</p></li>
<li><p>.subnet</p></li>
<li><p>.prefix</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>network_interfaces</dt><dd><ul>
<li><p>.ip4</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>hostvars[host]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>network_interfaces</dt><dd><ul>
<li><p>.ip4</p></li>
<li><p>.mac</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>external_dns.dns_server</p></li>
</ul>
<p><strong>hostvars[hosts]</strong></p>
<ul class="simple">
<li><p>alias</p></li>
<li><dl class="simple">
<dt>bmc</dt><dd><ul>
<li><p>.ip4</p></li>
<li><p>.mac</p></li>
<li><p>.name</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id23">
<h4><span class="section-number">11.1.6.4. </span>Output<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<p>Packages installed:</p>
<ul class="simple">
<li><p>bind dns server</p></li>
</ul>
<p>Files generated:</p>
<ul class="simple">
<li><p>/etc/named.conf</p></li>
<li><p>/var/named/forward</p></li>
<li><p>/var/named/reverse</p></li>
<li><p>/var/named/forward.soa</p></li>
<li><p>/var/named/reverse.soa</p></li>
</ul>
</div>
<div class="section" id="id24">
<h4><span class="section-number">11.1.6.5. </span>Changelog<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.1: Added SOA. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="dns-client">
<h3><span class="section-number">11.1.7. </span>DNS client<a class="headerlink" href="#dns-client" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id25">
<h4><span class="section-number">11.1.7.1. </span>Description<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<p>This role provides a basic /etc/resolv.conf file.</p>
</div>
<div class="section" id="id26">
<h4><span class="section-number">11.1.7.2. </span>Instructions<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<p>It is possible to add here external DNS servers for clients.
Configuration is made in <em>group_vars/all/general_settings/external.yml</em>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">external_dns</span><span class="p">:</span>
  <span class="nt">dns_client</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
    <span class="l l-Scalar l-Scalar-Plain">- 208.67.220.220</span>
</pre></div>
</div>
<p>Note that this/these external(s) dns will be placed after the cluster internal dns in resolution order.</p>
</div>
<div class="section" id="id27">
<h4><span class="section-number">11.1.7.3. </span>Input<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>domain_name</p></li>
<li><dl class="simple">
<dt>network[item]</dt><dd><ul>
<li><p>.services_ip.dns_ip</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>external_dns.dns_client</p></li>
</ul>
</div>
<div class="section" id="id28">
<h4><span class="section-number">11.1.7.4. </span>Output<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<p>Files generated:</p>
<ul class="simple">
<li><p>/etc/resolv.conf</p></li>
</ul>
</div>
<div class="section" id="id29">
<h4><span class="section-number">11.1.7.5. </span>Changelog<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.4: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.3: Added support of multiple DNS servers. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.0.2: Added variable for role version. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="firewall">
<h3><span class="section-number">11.1.8. </span>Firewall<a class="headerlink" href="#firewall" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id30">
<h4><span class="section-number">11.1.8.1. </span>Description<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<p>This role configures the firewall service on the hosts.</p>
<p>For each network interface of the host where the play runs, this role binds the
source address <strong>subnet/prefix</strong> to the zone defined in <strong>firewall.zone</strong> if
the network must be in the firewall.</p>
</div>
<div class="section" id="id31">
<h4><span class="section-number">11.1.8.2. </span>Instructions<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<div class="section" id="inventory-configuration">
<h5><span class="section-number">11.1.8.2.1. </span><strong>Inventory configuration</strong><a class="headerlink" href="#inventory-configuration" title="Permalink to this headline">¶</a></h5>
<p>Enable or disable the firewall service in the equipment profile:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ep_firewall</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>To add a network of the host to a zone, define the zone name in
<strong>firewall.zone</strong> in the network:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">networks</span><span class="p">:</span>
  <span class="nt">ice1-1</span><span class="p">:</span>
    <span class="nt">subnet</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.0</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">netmask</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">255.255.0.0</span>
    <span class="nt">broadcast</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.255.255</span>
    <span class="nt">gateway</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.2.1</span>
    <span class="nt">firewall</span><span class="p">:</span>
      <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">internal</span>
  <span class="nt">interconnect-1</span><span class="p">:</span>
    <span class="nt">subnet</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.20.0.0</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">firewall</span><span class="p">:</span>
      <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">trusted</span>
</pre></div>
</div>
<p>To add or delete custom services that are not handled by any other role, define
the <cite>firewall_zones</cite> parameter as below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">firewall_zones</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">internal            &lt;&lt;&lt; zone name</span>
    <span class="nt">services_enabled</span><span class="p">:</span>         <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt; list of service to enable</span>
      <span class="l l-Scalar l-Scalar-Plain">- high-availability</span>
      <span class="l l-Scalar l-Scalar-Plain">- prometheus</span>
    <span class="nt">services_disabled</span><span class="p">:</span>        <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt; list of service to disable</span>
      <span class="l l-Scalar l-Scalar-Plain">- cockpit</span>
</pre></div>
</div>
<p>It is possible to add or delete custom ports and rich rules with the same
parameter:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">firewall_zones</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">zone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">internal            &lt;&lt;&lt; zone name</span>
    <span class="nt">ports_enabled</span><span class="p">:</span>            <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt; list of ports to enable</span>
      <span class="l l-Scalar l-Scalar-Plain">- 1234/tcp</span>
    <span class="nt">ports_disabled</span><span class="p">:</span>           <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt; list of ports to disable</span>
      <span class="l l-Scalar l-Scalar-Plain">- 5678/tcp</span>
    <span class="nt">rich_rules_enabled</span><span class="p">:</span>       <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt; list of rich rules to enable</span>
      <span class="l l-Scalar l-Scalar-Plain">- &quot;rule family=ipv4 forward-port port=443 protocol=tcp to-port=8443&quot;</span>
    <span class="nt">rich_rules_disabled</span><span class="p">:</span>      <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt; list of rich rules to disable</span>
      <span class="l l-Scalar l-Scalar-Plain">- &#39;rule service name=&quot;ftp&quot; audit limit value=&quot;1/m&quot; accept&#39;</span>
    <span class="nt">icmp_block_inversion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="nt">masquerade</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>
</div>
</div>
<div class="section" id="integration-with-other-roles">
<h5><span class="section-number">11.1.8.2.2. </span><strong>Integration with other roles</strong><a class="headerlink" href="#integration-with-other-roles" title="Permalink to this headline">¶</a></h5>
<p>BlueBanquise ships with roles that already support some level of firewall
configuration by adding services to the default zone (public). For each role,
it is possible to override the default zone by setting
<strong>${rolename}_firewall_zone</strong> in the inventory.</p>
<p>For example, if you want to add the services of the pxe_stack roles to the
internal zone, you must set the variable <cite>pxe_stack_firewall_zone: internal</cite>.</p>
</div>
</div>
<div class="section" id="id32">
<h4><span class="section-number">11.1.8.3. </span>Input<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>ep_firewall</p></li>
<li><dl class="simple">
<dt>network[item]</dt><dd><ul>
<li><p>.subnet</p></li>
<li><p>.prefix</p></li>
<li><dl class="simple">
<dt>.firewall</dt><dd><ul>
<li><p>.zone</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>network_interfaces</dt><dd><ul>
<li><p>.network</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>firewall_zones</dt><dd><ul>
<li><p>zone</p></li>
<li><p>services_enabled     (list)</p></li>
<li><p>services_disabled    (list)</p></li>
<li><p>ports_enabled        (list)</p></li>
<li><p>ports_disabled       (list)</p></li>
<li><p>rich_rules_enabled   (list)</p></li>
<li><p>rich_rules_disabled  (list)</p></li>
<li><p>icmp_blocks_enabled  (list)</p></li>
<li><p>icmp_blocks_disabled (list)</p></li>
<li><p>icmp_block_inversion (bool)</p></li>
<li><p>masquerade           (bool)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id33">
<h4><span class="section-number">11.1.8.4. </span>Output<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h4>
<p>Package installed:</p>
<ul class="simple">
<li><p>firewall</p></li>
</ul>
</div>
<div class="section" id="id34">
<h4><span class="section-number">11.1.8.5. </span>Changelog<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.0: Role creation. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="hosts-file">
<h3><span class="section-number">11.1.9. </span>Hosts file<a class="headerlink" href="#hosts-file" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id35">
<h4><span class="section-number">11.1.9.1. </span>Description<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p>This role provides a basic /etc/hosts files.</p>
</div>
<div class="section" id="id36">
<h4><span class="section-number">11.1.9.2. </span>Instructions<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h4>
<p>This role will gather all hosts from the inventory, and add them, using all
their known internal network connections ip, into <em>/etc/hosts</em> file.</p>
<p>In case of multiple icebergs system, administrator can reduce the scope of this
gathering using <strong>hosts_file.range</strong> variable in
<em>group_vars/all/general_settings/general.yml</em>.
Setting <strong>range</strong> to <em>all</em> will use all Ansible inventory hosts, while setting
<strong>range</strong> to <em>iceberg</em> will reduce the gathering to the current host iceberg.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hosts_file</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
  <span class="l l-Scalar l-Scalar-Plain">range</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span> <span class="c1"># can be all (all hosts) or iceberg (iceberg only)</span>
</pre></div>
</div>
<p>External hosts defined in <em>group_vars/all/general_settings/external.yml</em>
at variable <strong>external_hosts</strong> will be automatically added in the <em>/etc/hosts</em>
file.</p>
</div>
<div class="section" id="id37">
<h4><span class="section-number">11.1.9.3. </span>Input<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[host]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>network_interfaces</dt><dd><ul>
<li><p>.ip4</p></li>
<li><p>.mac</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[hosts]</strong></p>
<ul class="simple">
<li><p>alias</p></li>
<li><p>global_alias</p></li>
<li><dl class="simple">
<dt>bmc</dt><dd><ul>
<li><p>.ip4</p></li>
<li><p>.mac</p></li>
<li><p>.name</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id38">
<h4><span class="section-number">11.1.9.4. </span>Output<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h4>
<p>Files generated:</p>
<ul class="simple">
<li><p>/etc/hosts</p></li>
</ul>
</div>
<div class="section" id="id39">
<h4><span class="section-number">11.1.9.5. </span>Changelog<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.7: Clean code. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.6: Update to new network_interfaces syntax. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.5: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.4: Rewrite whole macro, add BMC alias. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.3: Accelerated mode. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.2: Added role version. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="log-server">
<h3><span class="section-number">11.1.10. </span>Log server<a class="headerlink" href="#log-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id40">
<h4><span class="section-number">11.1.10.1. </span>Description<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h4>
<p>This role provides an rsyslog server to gather logs of all hosts.</p>
</div>
<div class="section" id="id41">
<h4><span class="section-number">11.1.10.2. </span>Instructions<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h4>
<p>All logs are separated by systemd instances into /var/log/rsyslog/ .</p>
<p>Log server port is set to 514 by default, and can be customized with log_server_port variable.</p>
</div>
<div class="section" id="id42">
<h4><span class="section-number">11.1.10.3. </span>Changelog<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.3: Enable log server port customization with log_server_port. strus38</p></li>
<li><p>1.0.1: Fixed bad template. Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="log-client">
<h3><span class="section-number">11.1.11. </span>Log client<a class="headerlink" href="#log-client" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id43">
<h4><span class="section-number">11.1.11.1. </span>Description<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h4>
<p>This role provides an rsyslog client, to be used in combinaison with the log_server role.</p>
</div>
<div class="section" id="id44">
<h4><span class="section-number">11.1.11.2. </span>Instructions<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h4>
<p>Log server port is set to 514 by default, and can be customized with log_client_server_port variable.
This value should be set accordingly to the log_server_port variable.</p>
</div>
<div class="section" id="to-be-done">
<h4><span class="section-number">11.1.11.3. </span>To be done<a class="headerlink" href="#to-be-done" title="Permalink to this headline">¶</a></h4>
<p>Integrate journalctl logging instead of rsyslog.</p>
</div>
<div class="section" id="id45">
<h4><span class="section-number">11.1.11.4. </span>Changelog<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.3: Enable log server port customization with log_client_server_port. strus38</p></li>
<li><p>1.0.1: Fixed bad template. Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="nfs-server">
<h3><span class="section-number">11.1.12. </span>NFS server<a class="headerlink" href="#nfs-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id46">
<h4><span class="section-number">11.1.12.1. </span>Description<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h4>
<p>This role provides an automatic nfs server that export on good networks desired directories.</p>
</div>
<div class="section" id="id47">
<h4><span class="section-number">11.1.12.2. </span>Instructions<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h4>
<p>All configuration is done in <em>group_vars/all/general_settings/nfs.yml</em>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nfs</span><span class="p">:</span>
  <span class="nt">softwares</span><span class="p">:</span>                                    <span class="c1"># Internal name of the nfs share</span>
    <span class="nt">mount</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/opt/softwares</span>                       <span class="c1"># What path server should export</span>
    <span class="nt">export</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/opt/softwares</span>                      <span class="c1"># Which path clients should mount this NFS (will be automatically created by client role)</span>
    <span class="nt">server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">arngrim</span>                             <span class="c1"># The server that export this storage space</span>
    <span class="nt">clients_groups</span><span class="p">:</span>                             <span class="c1"># Group of hosts that will mount it. Can be an equipment group, or a main group (mg), or any other ansible group</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mg_computes</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mg_logins</span>
    <span class="nt">take_over_network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>                   <span class="c1"># Network used to share this storage space</span>
    <span class="nt">export_arguments</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ro,no_root_squash,async</span>   <span class="c1"># Arguments for the server (export)</span>
    <span class="nt">mount_arguments</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ro,intr,nfsvers=4.2,bg</span>     <span class="c1"># Arguments for the client (mount)</span>
</pre></div>
</div>
<p>This role will not modify default nfs server configuration (number of threads, nfs v4.2 force, etc).</p>
</div>
<div class="section" id="id48">
<h4><span class="section-number">11.1.12.3. </span>Input<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>nfs[item]</dt><dd><ul>
<li><p>.mount</p></li>
<li><p>.export</p></li>
<li><p>.server</p></li>
<li><p>.clients_groups</p></li>
<li><p>.export_arguments</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>nfs[item]</dt><dd><ul>
<li><p>.take_over_network</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id49">
<h4><span class="section-number">11.1.12.4. </span>Output<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h4>
<p>Add exported folder into /etc/exports .</p>
<p>Packages installed:</p>
<ul class="simple">
<li><p>nfs server utils</p></li>
</ul>
</div>
<div class="section" id="id50">
<h4><span class="section-number">11.1.12.5. </span>Changelog<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.4: Added molecule tests. osmocl &lt;<a class="reference external" href="mailto:osmocl&#37;&#52;&#48;osmo&#46;cl">osmocl<span>&#64;</span>osmo<span>&#46;</span>cl</a>&gt;</p></li>
<li><p>1.0.3: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.2: Added Ubuntu 18.04 compatibility. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Fixed bad template. Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="nfs-client">
<h3><span class="section-number">11.1.13. </span>NFS client<a class="headerlink" href="#nfs-client" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id51">
<h4><span class="section-number">11.1.13.1. </span>Description<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h4>
<p>This role provides an automatic nfs client that mount targets and create local
directories if needed.</p>
</div>
<div class="section" id="id52">
<h4><span class="section-number">11.1.13.2. </span>Instructions<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h4>
<p>All configuration is done in <em>group_vars/all/general_settings/nfs.yml</em>.</p>
<p>See the <strong>nfs_server</strong> role instructions for more details.</p>
<p>Simply note that paths that should be mounted will be automatically created by
this role if they do not exist.</p>
</div>
<div class="section" id="id53">
<h4><span class="section-number">11.1.13.3. </span>Input<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>nfs[item]</dt><dd><ul>
<li><p>.mount</p></li>
<li><p>.export</p></li>
<li><p>.server</p></li>
<li><p>.clients_groups</p></li>
<li><p>.mount_arguments</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>nfs[item]</dt><dd><ul>
<li><p>.take_over_network</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id54">
<h4><span class="section-number">11.1.13.4. </span>Output<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h4>
<p>Create missing folders and mount nfs on them.</p>
<p>Packages installed:</p>
<ul class="simple">
<li><p>nfs client utils</p></li>
</ul>
</div>
<div class="section" id="id55">
<h4><span class="section-number">11.1.13.5. </span>Changelog<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.4: Added new variable to allow all possible mount values in state parameter. Osmocl &lt;<a class="reference external" href="mailto:osmocl&#37;&#52;&#48;osmo&#46;cl">osmocl<span>&#64;</span>osmo<span>&#46;</span>cl</a>&gt;</p></li>
<li><p>1.0.3: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.2: Added Ubuntu 18.04 compatibility. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Fixed bad template. Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="nic">
<h3><span class="section-number">11.1.14. </span>NIC<a class="headerlink" href="#nic" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id56">
<h4><span class="section-number">11.1.14.1. </span>Description<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h4>
<p>This role configure network interfaces to provide desired ip, prefix, gateway, etc.</p>
</div>
<div class="section" id="id57">
<h4><span class="section-number">11.1.14.2. </span>Instructions<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h4>
<p>This role provide network configuration based on system files (ifcfg files for RHEL/Centos systems).</p>
<p>User need to restart network or interfaces one by one for changes to take effect after role execution.</p>
<p>As a reminder, the creation of a new network requires a new entry in the
<code class="docutils literal notranslate"><span class="pre">/etc/bluebanquise/inventory/group_vars/all/general_settings/network.yml</span></code> file.</p>
<p>Network interfaces configurations are done at host level:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">network_interfaces</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">enp0s3</span>        <span class="c1"># Interface name on system</span>
    <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.1</span>           <span class="c1"># ip v4 to be set</span>
    <span class="nt">mac</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">08:00:27:de:42:22</span>   <span class="c1"># MAC address of this NIC</span>
    <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>          <span class="c1"># Logical network connected to</span>
</pre></div>
</div>
<p>By default, connections are of type ethernet. It is possible to specify connection type, for example infiniband:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">network_interfaces</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ib0</span>
    <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.20.0.1</span>
    <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">interconnect-1</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">infiniband</span>
</pre></div>
</div>
<p>To configure an LACP bonding, specify slave interfaces, and then create the bond, using bond-slave type and bond type:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">network_interfaces</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond0</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond</span>
    <span class="nt">vlan</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">bond_options</span><span class="p">:</span> <span class="s">&quot;mode=4</span><span class="nv"> </span><span class="s">xmit_hash_policy=layer3+4</span><span class="nv"> </span><span class="s">miimon=100</span><span class="nv"> </span><span class="s">lacp_rate=1&quot;</span>
    <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.100.0.1</span>
    <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eth0</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond-slave</span>
    <span class="nt">master</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond0</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eth1</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond-slave</span>
    <span class="nt">master</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond0</span>
</pre></div>
</div>
<p>To configure a VLAN, simply set vlan to true.</p>
<p>In this example we want to use a dedicated subnet for VLAN 100,
we have created a net-100 network (corresponding to VLAN 100).</p>
<p>Otherwise, you can just use an existing network.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">network_interfaces</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vlan100</span>
    <span class="nt">vlan</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">vlan_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class="nt">physical_device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eth2</span>
    <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.100.0.1</span>
    <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">net-100</span>
</pre></div>
</div>
<p>A full example with VLAN over bond would be:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">network_interfaces</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eth3</span>
    <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lk1</span>
    <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">172.16.0.2</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond0</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond</span>
    <span class="nt">bond_options</span><span class="p">:</span> <span class="s">&quot;mode=4</span><span class="nv"> </span><span class="s">xmit_hash_policy=layer3+4</span><span class="nv"> </span><span class="s">miimon=100</span><span class="nv"> </span><span class="s">lacp_rate=1&quot;</span>
    <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>
    <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">172.21.2.102</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond0.100</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vlan</span>
    <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-2</span>
    <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.100.0.1</span>
    <span class="nt">vlan</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">vlan_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class="nt">physical_device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond0</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond0.1</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vlan</span>
    <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-3</span>
    <span class="nt">ip4</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.1.0.1</span>
    <span class="nt">vlan</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">vlan_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">physical_device</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond0</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">enp136s0f0</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond-slave</span>
    <span class="nt">master</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond0</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">enp136s0f1</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond-slave</span>
    <span class="nt">master</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bond0</span>
</pre></div>
</div>
<p>It is also possible to configure multiple ip per interface, using:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">network_interfaces</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">interface</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eth3</span>
    <span class="nt">network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lk1</span>
    <span class="nt">ip4_multi</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">172.16.0.2/16</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">172.16.0.3/16</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">192.168.1.117/24</span>
</pre></div>
</div>
<p>MTU and/or Gateway can be set in the network file, and will be applyed to NIC linked to this network.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">networks</span><span class="p">:</span>
  <span class="nt">ice1-1</span><span class="p">:</span>
    <span class="nt">subnet</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.0</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">netmask</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">255.255.0.0</span>
    <span class="nt">broadcast</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.255.255</span>
    <span class="nt">dhcp_unknown_range</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.254.1 10.10.254.254</span>
    <span class="nt">gateway</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.2.1     &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
    <span class="nt">mtu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9000              &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
    <span class="nt">is_in_dhcp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">is_in_dns</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">services_ip</span><span class="p">:</span>
      <span class="nt">pxe_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">dns_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">repository_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">authentication_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">time_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">log_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
</pre></div>
</div>
</div>
<div class="section" id="id58">
<h4><span class="section-number">11.1.14.3. </span>To be done<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h4>
<p>Add Ubuntu and Opensuse compatibility if asked for.</p>
</div>
<div class="section" id="id59">
<h4><span class="section-number">11.1.14.4. </span>Changelog<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.3: Update readme. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.2: Update to new network_interfaces syntax. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Fix VLAN and BOND. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="pxe-stack">
<h3><span class="section-number">11.1.15. </span>PXE Stack<a class="headerlink" href="#pxe-stack" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id60">
<h4><span class="section-number">11.1.15.1. </span>Description<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h4>
<p>This role provides the whole PXE stack. It is a key feature of the stack.</p>
</div>
<div class="section" id="id61">
<h4><span class="section-number">11.1.15.2. </span>Instructions<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h4>
<p>This role will deploy all the needed files, binaries, and scripts to deploy
remote hosts using PXE (or even USB and CD boot).</p>
<p>The role takes place just after the dhcp in the PXE deployment, and will
configure all the iPXE chain needed after dhcp provided hosts with next-server
ip address and filename to use.</p>
<div class="section" id="files-location">
<h5><span class="section-number">11.1.15.2.1. </span><strong>Files location</strong><a class="headerlink" href="#files-location" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><dl class="simple">
<dt>PXE boot files are located in /var/www/html/preboot_execution_environment/, with path depending of the operating system.</dt><dd><ul>
<li><p><em>bin/</em> directory contains some needed bin files, typically grub2 files for EFI boot.</p></li>
<li><p><em>equipment_profiles/</em> directory contains equipment_profiles related files, i.e. ipxe file with group variables, and os configuration files (kickstart, preseed, autoyast).</p></li>
<li><p><em>nodes/</em> directory contains hosts dedicated files, i.e. ipxe file with hosts dedicated variables.</p></li>
<li><p><em>osdeploy/</em> directory contains static files, with patterns to boot each kind of supported distributions.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Basic configuration files are located in /etc/bluebanquise/pxe/.</dt><dd><ul>
<li><p><em>nodes_parameters.yml</em> contains all nodes PXE needed parameters.</p></li>
<li><p><em>pxe_parameters.yml</em> contains needed values for scripts to adapt to <strong>current pxe server host</strong> (these parameters do not apply to PXE booted hosts !!).</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Scripts are located in /usr/bin/.</p></li>
</ul>
</div>
<div class="section" id="id62">
<h5><span class="section-number">11.1.15.2.2. </span><strong>Inventory configuration</strong><a class="headerlink" href="#id62" title="Permalink to this headline">¶</a></h5>
<p>This role will rely on multiple parts of the inventory, and is probably the most “invasive” role of the whole stack.</p>
<ul class="simple">
<li><p>equipment_profile parameters are used for each equipment_profile group. All
boot configuration is made relying on it (operating system, cpu architecture,
console, kernel parameters, etc.). It is recommended to ensure coherency of
the equipment_profile files.</p></li>
<li><p>authentication parameters are used to provide root password and default ssh
authorized key.</p></li>
<li><p>hosts <strong>network_interfaces</strong> dedicated variables, to be able to force static
ip address at kernel boot.</p></li>
</ul>
</div>
<div class="section" id="bootset-usage">
<h5><span class="section-number">11.1.15.2.3. </span><strong>bootset usage</strong><a class="headerlink" href="#bootset-usage" title="Permalink to this headline">¶</a></h5>
<p>Once the role is deployed, and hosts gathered into <em>/etc/bluebanquise/pxe/nodes_parameters.yml</em>, the bootset tool can be used to manipulate remote hosts PXE boot. By default, 3 states can be defined for each host:</p>
<ul class="simple">
<li><p>osdeploy: the remote host will deploy/redeploy its operating system, using inventory equipment_profile parameters of its equipment profile group.</p></li>
<li><p>disk: the remote host will boot on disk. This parameter is automatically set after a successful <strong>osdeploy</strong>.</p></li>
<li><p>diskless: the remote host will boot using a diskless mechanism. This diskless boot is generic, and is handled by an optional external role.</p></li>
</ul>
<p>Again, consider that if you set an host to osdeploy, and that it succeed its deployment, stack will automatically set the host into disk boot for next boot, to avoid infinite reinstallation loop.</p>
<p>To get bootset help, use:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bootset -h
</pre></div>
</div>
<p>To ask an host to deploy/redeploy its operating system, use:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bootset -n c001 -b osdeploy
</pre></div>
</div>
<p>With c001 the target host to be redeployed.</p>
<p>To set this host to boot on disk, use:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bootset -n c001 -b disk
</pre></div>
</div>
<p>It is also possible to work on a range of host, using nodeset formatting:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bootset -n c001,c002,c[010-020],login1 -b disk
</pre></div>
</div>
<p>Also, if combined with <strong>clustershell</strong> addon role, it is possible to use Ansible inventory groups:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bootset -n @mg_computes -b disk
</pre></div>
</div>
<p>If some inventory parameters related to the host have been updated recently, it may be required to force files regeneration instead of simply modifying them. To do so, use:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bootset -n c001 -b osdeploy -f update
</pre></div>
</div>
<p>Also, on some “difficult” networks, system administrator may require to force static ip at boot. This can be achieved using:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bootset -n c001 -b osdeploy -f network
</pre></div>
</div>
<p>Or in combinaison with update, using comma separated:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bootset -n c001 -b osdeploy -f update,network
</pre></div>
</div>
<p>The tool is relatively verbose, and should provide all needed information on the fly on what it is doing.</p>
<p>Last part, regarding diskless. An image name need to be provided:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bootset -n c001 -b diskless -i myimage
</pre></div>
</div>
<p>This part should be covered in a diskless related role, and is not in the scope of this role.</p>
</div>
<div class="section" id="ipxe-chain">
<h5><span class="section-number">11.1.15.2.4. </span><strong>iPXE chain</strong><a class="headerlink" href="#ipxe-chain" title="Permalink to this headline">¶</a></h5>
<p>PXE part of the <strong>BlueBanquise</strong> stack relies heavily on iPXE, and its chain mechanism. This chain has multiple purposes:</p>
<ul class="simple">
<li><p>Most important, it is verbose, and can be manually manipulated or followed (watching http server logs).</p></li>
<li><p>It is flexible, and can adapt to nearly any configuration (disk boot, os deployment, diskless, …).</p></li>
<li><p>It can operate on all hardware, from server to laptop. It can even be started from USB or CD image for non PXE able systems.</p></li>
</ul>
<p>Some steps may seems weird or unnecessary, but are here on purpose: verbosity and debug, as PXE part is always the trickiest.</p>
<p>Some vocabulary: in the following document, <strong>chain* or **chaining</strong> refers to the iPXE mechanism that download and execute a new file, after the current one.</p>
<p>Also, all files root is assumed <em>/var/www/html/preboot_execution_environnement</em> on the next-server (the server on which this pxe_stack role has been deployed).</p>
<p>The whole process can be resumed in one detailed schema:</p>
<img alt="_images/iPXE_chain.svg" src="_images/iPXE_chain.svg" /><p>To be macroscopic:</p>
<ol class="arabic simple">
<li><p>The remote host boot over PXE, in EFI/legacy-bios, using its own PXE/iPXE rom.</p></li>
<li><p>The dhcp deployed by BlueBanquise will provide the host with the <strong>BlueBanquise</strong> iPXE rom. This iPXE rom contains an EMBED script that will display the logo, get an ip from the dhcp server, show some information, and chain to file <em>convergence.ipxe</em>.</p></li>
<li><p><em>convergence.ipxe</em> will simply get the current architecture. This operation cannot be done into the EMBED script has it needs some logic, that could bug. Sys admin need to easily debug this without the need to rebuild iPXE roms. Then iPXE chain to <em>nodes/${hostname}.ipxe</em> with <em>hostname</em> the hostname provided by the dhcp server.</p></li>
<li><p><em>nodes/${hostname}.ipxe</em> will define all host dedicated parameters, and also what host should do: boot on disk, deploy os, or boot in diskless. Then iPXE chain to <em>equipment_profiles/${equipment-profile}.ipxe</em>, with <em>equipment-profile</em> a variable defined in the current file.</p></li>
<li><p><em>equipment_profiles/${equipment-profile}.ipxe</em> contains the host equipment profile group parameters, like operating system, console, kernel parameters, etc. Then iPXE chain to <em>menu.ipxe</em>.</p></li>
<li><p><em>menu.ipxe</em> will display a basic menu on screen, with default set to what node is expected to do (this was gathered in <em>nodes/${hostname}.ipxe</em>). Timeout is 10s by default before host execute the expected action. Then, iPXE chain to:</p>
<ul class="simple">
<li><p><em>osdeploy/${eq-distribution}_${eq-distribution-major-version}.ipxe</em> if host needs to deploy/redeploy its operating system. These osdeploy files are dynamic, and adapt to parameters gathered in host dedicated file and host equipment_profile file.</p></li>
<li><p><em>diskless/images/${diskless-image}/boot.ipxe</em> if host needs to boot in diskless.</p></li>
<li><p><em>sanboot –no-describe –drive 0x80</em> if host is legacy/bios/pcbios based. This is a simple command that boot on disk.</p></li>
<li><p><em>bin/${arch}/grub2_efi_autofind.img</em> if host is EFI based. This grub2 image will look for a disk with a know operating system, and boot on it.</p></li>
</ul>
</li>
</ol>
<p>In case of an OS deployment, if this deployment succeed, in the post install script section, remote host will ask, using a curl command on its side and an CGI python script on server side (<em>/var/www/cgi-bin/bootswitch.cgi</em>), to boot next to disk. This CGI python script will simply edit <em>node/${hostname}.ipxe</em> file and change its default boot to <strong>bootdisk</strong>.</p>
<p>All files are manually editable. Also, note that an unregistered host (so no hostnames provided by the dhcp) will try to load <em>nodes/.ipxe</em> file. By default, this file will simply provide an iPXE shell, but system administrator can tune this file to specific purposes.</p>
<p>To follow the deployment process, simply tail -f logs of http server, and see the whole process occurring.</p>
</div>
</div>
<div class="section" id="optional-parameters">
<h4><span class="section-number">11.1.15.3. </span>Optional parameters<a class="headerlink" href="#optional-parameters" title="Permalink to this headline">¶</a></h4>
<p>It is possible to use another tftp server than atftp, using variables. By
default, BlueBanquise relies on atftp, but fbtftp is also provided.</p>
<p>To set the desired tftp server, and override default (atftp), define in the
inventory or in the playbook the following variables:</p>
<ul class="simple">
<li><p><strong>pxe_stack_tftp_package</strong>: set the package name of the tftp server to be used. Stack propose <em>atftp</em> or <em>fbtftp_server</em>.</p></li>
<li><p><strong>pxe_stack_tftp_service</strong>: set the service name of the tftp server to be used. Stack propose <em>atftpd</em> or <em>fbtftp_server</em>.</p></li>
</ul>
</div>
<div class="section" id="id63">
<h4><span class="section-number">11.1.15.4. </span>To be done<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Issue when deploying ubuntu 18.04. Very long hang after packages check. Install continue after like 10 minutes of hang. Not blocking but boring…</p></li>
</ul>
</div>
<div class="section" id="id64">
<h4><span class="section-number">11.1.15.5. </span>Changelog<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.1.6: Add ability to install other tftp server than atftp. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.1.5: Update role to match $basearch, add status feat to bootset. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.1.4: Update to new network_interfaces syntax. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.1.3: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.1.2: Add support of major distribution version. Bruno &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.1.1: bootset.py refactoring. Adrien Ribeiro &lt;<a class="reference external" href="mailto:adrien&#46;ribeiro&#37;&#52;&#48;atos&#46;net">adrien<span>&#46;</span>ribeiro<span>&#64;</span>atos<span>&#46;</span>net</a>&gt;</p></li>
<li><p>1.1.0: Rewamped the whole role. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.2: Add Ubuntu 18.04 compatibility. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="repositories-server">
<h3><span class="section-number">11.1.16. </span>Repositories server<a class="headerlink" href="#repositories-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id65">
<h4><span class="section-number">11.1.16.1. </span>Description<a class="headerlink" href="#id65" title="Permalink to this headline">¶</a></h4>
<p>This role simply configures repositories server (only install and start web
server).</p>
</div>
<div class="section" id="id66">
<h4><span class="section-number">11.1.16.2. </span>Instructions<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h4>
<p>This role simply install an http server. Repositories files manipulations have
to be done manually by system administrator. Refer to main documentation.</p>
<p>There is a split between boot images and packages repositories. Boot images
include the installer system which starts the deployment after PXE boot, while
packages repositories include the software that will be installed on the
systems.</p>
<p>Boot images repositories structure follows a specific pattern and includes the
minor release version in the path:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>           Distribution    Version   Architecture    Repository
                 +             +       +               +
                 <span class="p">|</span>             +--+    <span class="p">|</span>               <span class="p">|</span>
                 +-----------+    <span class="p">|</span>    <span class="p">|</span>    +----------+
                             <span class="p">|</span>    <span class="p">|</span>    <span class="p">|</span>    <span class="p">|</span>
                             v    v    v    v
/var/www/html/repositories/centos/7.6/x86_64/os/
</pre></div>
</div>
<p>Packages repositories structure follows a specific pattern, which defaults to
the major release version in the path:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>           Distribution    Version   Architecture    Repository
                 +             +       +               +
                 <span class="p">|</span>             +--+    <span class="p">|</span>               <span class="p">|</span>
                 +-----------+    <span class="p">|</span>    <span class="p">|</span>    +----------+
                             <span class="p">|</span>    <span class="p">|</span>    <span class="p">|</span>    <span class="p">|</span>
                             v    v    v    v
/var/www/html/repositories/centos/7/x86_64/os/
</pre></div>
</div>
<p>System administrator should create these directories manually, and put boot
images and packages inside.</p>
<p>Note: we recommend to use the same directory path to later sync the Errata
published by upstream operating system vendor.</p>
<p>Then, repositories that will be setup on clients are stored by default in
<em>/etc/bluebanquise/inventory/group_vars/all/general_settings/repositories.yml</em>.</p>
<p>Keep in mind that it is possible to precede this file in equipment_profiles
groups, and so put a repository file in for example
<em>/etc/bluebanquise/inventory/group_vars/equipment_supermicro_sandy_compute</em>
that will be considered by these nodes over the default one. This can be useful
to define different repositories for different equipment.</p>
</div>
<div class="section" id="id67">
<h4><span class="section-number">11.1.16.3. </span>Input<a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h4>
<p>None</p>
</div>
<div class="section" id="id68">
<h4><span class="section-number">11.1.16.4. </span>Output<a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h4>
<p>Http server packages installed.</p>
</div>
<div class="section" id="id69">
<h4><span class="section-number">11.1.16.5. </span>Changelog<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.3: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.2: Regrouped all distribs into a main file. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="repositories-client">
<h3><span class="section-number">11.1.17. </span>Repositories client<a class="headerlink" href="#repositories-client" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id70">
<h4><span class="section-number">11.1.17.1. </span>Description<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h4>
<p>This role simply configure repositories for client hosts.</p>
</div>
<div class="section" id="id71">
<h4><span class="section-number">11.1.17.2. </span>Instructions<a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h4>
<p>See repositories_server role instructions for general repositories path details.</p>
<p>Repositories are set in <strong>repositories</strong> variable. Two shapes are available: a
simple one and an advanced one.</p>
<p>Simple one:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">repositories</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">os</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bluebanquise</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">myrepo</span>
</pre></div>
</div>
<p>Advanced one, to be combined with simple one as desired:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">repositories</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">os</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bluebanquise</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">epel</span>
    <span class="nt">baseurl</span><span class="p">:</span> <span class="s">&#39;https://dl.fedoraproject.org/pub/epel/$releasever/$basearch/&#39;</span>
    <span class="nt">proxy</span><span class="p">:</span> <span class="s">&#39;https://proxy:8080&#39;</span>
</pre></div>
</div>
<p>Available advanced variables are:</p>
<ul class="simple">
<li><p>name</p></li>
<li><p>baseurl</p></li>
<li><p>enabled</p></li>
<li><p>exclude</p></li>
<li><p>gpgcheck</p></li>
<li><p>gpgkey</p></li>
<li><p>proxy</p></li>
<li><p>state</p></li>
</ul>
<p>Repository static path is computed using variables defined in the equipment_profile.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">operating_system</span><span class="p">:</span>
  <span class="nt">distribution</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">centos</span> <span class="c1"># centos, redhat, debian, ubuntu, opensuse, etc.</span>
  <span class="nt">distribution_major_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8</span>
  <span class="c1"># Optional: define a minor distribution version to force (repositories/PXE)</span>
  <span class="c1">#distribution_version: 8.0</span>
  <span class="c1"># Optional: add an environment in the repositories path (eg. production, staging) (repositories/PXE)</span>
  <span class="c1">#repositories_environment: production</span>
</pre></div>
</div>
<p>If equipment_profile is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ep_operating_system</span><span class="p">:</span>
  <span class="nt">distribution</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">centos</span>
  <span class="nt">distribution_major_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8</span>
</pre></div>
</div>
<p>Then path will be: repositories/centos/8/$basearch/</p>
<p>If equipment_profile is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ep_operating_system</span><span class="p">:</span>
  <span class="nt">distribution</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">centos</span>
  <span class="nt">distribution_major_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8</span>
  <span class="nt">distribution_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8.1</span>
</pre></div>
</div>
<p>Then path will be: repositories/centos/8.1/$basearch/</p>
<p>If equipment_profile is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ep_operating_system</span><span class="p">:</span>
  <span class="nt">distribution</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">centos</span>
  <span class="nt">distribution_major_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8</span>
  <span class="nt">distribution_version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8.1</span>
  <span class="nt">repositories_environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">production</span>
</pre></div>
</div>
<p>Then path will be: repositories/production/centos/8.1/$basearch/</p>
<p>For CentOS, the role will disable the default repositories of the distribution.
If one want to keep the distro repositories, they must define
<cite>repositories_client_disable_distro_repos: False</cite> in their inventory.</p>
</div>
<div class="section" id="id72">
<h4><span class="section-number">11.1.17.3. </span>Input<a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>repositories[item]</p></li>
<li><dl class="simple">
<dt>ep_operating_system</dt><dd><ul>
<li><p>distribution</p></li>
<li><p>distribution_major_version</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>ep_operating_system</dt><dd><ul>
<li><p>distribution_version</p></li>
<li><p>repositories_environment</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>repositories_client_disable_distro_repos (CentOS only)</p></li>
</ul>
</div>
<div class="section" id="id73">
<h4><span class="section-number">11.1.17.4. </span>Output<a class="headerlink" href="#id73" title="Permalink to this headline">¶</a></h4>
<p>Repositories are set.</p>
</div>
<div class="section" id="id74">
<h4><span class="section-number">11.1.17.5. </span>To be done<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h4>
<p>Need to clear up the Ubuntu repositories process, still not clear how to handle
own made repos and officials repos as Ubuntu add local repos everywhere in the
sources.list file.</p>
</div>
<div class="section" id="id75">
<h4><span class="section-number">11.1.17.6. </span>Changelog<a class="headerlink" href="#id75" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.8: Add state parameter. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.0.7: Simplified version of the role. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.6: Deprecate external_repositories. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.0.5: Added support for excluding packages from CentOS and RHEL repositories. Neil Munday &lt;<a class="reference external" href="mailto:neil&#37;&#52;&#48;mundayweb&#46;com">neil<span>&#64;</span>mundayweb<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.4: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.3: Add support of major release version. Bruno &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.0.2: Added Ubuntu 18.04 compatibility. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="set-hostname">
<h3><span class="section-number">11.1.18. </span>Set Hostname<a class="headerlink" href="#set-hostname" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id76">
<h4><span class="section-number">11.1.18.1. </span>Description<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h4>
<p>This role simply set a node hostname.</p>
</div>
<div class="section" id="id77">
<h4><span class="section-number">11.1.18.2. </span>Instructions<a class="headerlink" href="#id77" title="Permalink to this headline">¶</a></h4>
<p>NA.</p>
</div>
<div class="section" id="id78">
<h4><span class="section-number">11.1.18.3. </span>Changelog<a class="headerlink" href="#id78" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.2: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="ssh-master">
<h3><span class="section-number">11.1.19. </span>SSH master<a class="headerlink" href="#ssh-master" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id79">
<h4><span class="section-number">11.1.19.1. </span>Description<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h4>
<p>This role configures the ssh access of inventory known hosts to ensure ssh access through nodes main network.</p>
</div>
<div class="section" id="id80">
<h4><span class="section-number">11.1.19.2. </span>Instructions<a class="headerlink" href="#id80" title="Permalink to this headline">¶</a></h4>
<div class="section" id="basic-usage">
<h5><span class="section-number">11.1.19.2.1. </span>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h5>
<p>This role will generate a configuration file in <em>/root/.ssh/config</em>.</p>
<p>This file will contains all hosts of the Ansible inventory (or all hosts of the
current iceberg if using icebergs mode), with the following parameters:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Host freya
    Hostname %h-ice1-1
</pre></div>
</div>
<p>And possibly add :</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>StrictHostKeyChecking no
UserKnownHostsFile=/dev/null
</pre></div>
</div>
<p>If asked for.</p>
<p>Note that for this example host, <strong>freya</strong>, the target hostname for ssh is
%h-ice1-1, which translates to <strong>freya-ice1-1</strong>. This can be seen when invoking
ssh with verbosity:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[root@odin ]# ssh freya -vvv
OpenSSH_7.8p1, OpenSSL 1.1.1 FIPS  11 Sep 2018
debug1: Reading configuration data /root/.ssh/config
debug1: /root/.ssh/config line 10: Applying options for freya
debug1: Reading configuration data /etc/ssh/ssh_config
debug3: /etc/ssh/ssh_config line 52: Including file /etc/ssh/ssh_config.d/05-redhat.conf depth 0
debug1: Reading configuration data /etc/ssh/ssh_config.d/05-redhat.conf
debug3: /etc/ssh/ssh_config.d/05-redhat.conf line 2: Including file /etc/crypto-policies/back-ends/openssh.config depth 1
debug1: Reading configuration data /etc/crypto-policies/back-ends/openssh.config
debug3: gss kex names ok: [gss-gex-sha1-,gss-group14-sha1-]
debug3: kex names ok: [curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group14-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1]
debug1: /etc/ssh/ssh_config.d/05-redhat.conf line 8: Applying options for *
debug2: resolving &quot;freya-ice1-1&quot; port 22
debug2: ssh_connect_direct
debug1: Connecting to freya-ice1-1 [10.11.2.1] port 22.
</pre></div>
</div>
<p>You can see here ssh is not trying to reach <strong>freya</strong> but is using
<strong>freya-ice-1-1</strong>. This has been made to ensure whatever the direct resolution
is in /etc/hosts or DNS, ssh and so Ansible will always use the management
network of the target host.</p>
<p>Also, keep in mind that when redeploying a host its SSH key changes, which
requires to remove the former host key from the known_hosts file, then add the
new key. It is possible to achieve this with the commands below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># for host in $(nodeset -e $NODES); do \</span>
    sed -i -e <span class="s2">&quot;/^</span><span class="si">${</span><span class="nv">host</span><span class="si">}</span><span class="s2">/d&quot;</span> /root/.ssh/known_hosts<span class="p">;</span> <span class="se">\</span>
<span class="k">done</span>
<span class="c1"># clush -o &#39;-o StrictHostKeyChecking=no&#39; -w $NODES dmidecode -s system-uuid</span>
</pre></div>
</div>
<p>It is possible to disable the strict host key checking in the inventory with the
configuration below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">security</span><span class="p">:</span>
  <span class="nt">ssh</span><span class="p">:</span>
    <span class="nt">hostkey_checking</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<p>This was the default behaviour prior BlueBanquise 1.3. The ssh configuration
file will include the following parameters:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Host freya
    StrictHostKeyChecking no
    UserKnownHostsFile=/dev/null
    Hostname %h-ice1-1
</pre></div>
</div>
<p>This ensure no issues when redeploying an host, at the cost of security.</p>
<p>Note that this file generation is kind of “sensible”, and will surely be the
first one to break in case of uncoherent inventory. If this happens, check your
inventory, fix it, and remove manually /root/.ssh/config and relaunch its
generation.</p>
</div>
<div class="section" id="multiple-iceberg-usage">
<h5><span class="section-number">11.1.19.2.2. </span>Multiple iceberg usage<a class="headerlink" href="#multiple-iceberg-usage" title="Permalink to this headline">¶</a></h5>
<p>The ssh_master role allows to enable ssh ProxyJump to ssh from a top iceberg to
hosts of a sub_iceberg, through one master of the sub_iceberg.
This allows simple central point to ansible-playbook.</p>
<p>To activate this feature, enable it first by adding in your inventory the
variable:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ssh_master_enable_jump</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>By default, the first management found in the group list of the sub_iceberg
will be used as ssh ProxyJump target. It is possible to manually override this,
in case of HA and virtual IP for example, by defining in the sub_iceberg variables
the desired target.</p>
<p>For example, to force ProxyJump target to be 10.10.0.77 for
iceberg3 hosts, in inventory/cluster/icebergs/iceberg3 file, add
ssh_master_iceberg_jump_target:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[iceberg3:vars]
iceberg_master = iceberg1
iceberg_level = 2
ssh_master_iceberg_jump_target = 10.10.0.77
</pre></div>
</div>
<p>In case of issue, try adding verbosity to the ssh invocation to investigate (-vvv).</p>
</div>
</div>
<div class="section" id="id81">
<h4><span class="section-number">11.1.19.3. </span>Input<a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[hosts]</strong></p>
<ul class="simple">
<li><p>network_interfaces[item]</p></li>
<li><p>icebergs_system</p></li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>security.ssh.hostkey_checking</p></li>
<li><p>ssh_master_enable_jump</p></li>
<li><p>ssh_master_iceberg_jump_target</p></li>
</ul>
</div>
<div class="section" id="id82">
<h4><span class="section-number">11.1.19.4. </span>Output<a class="headerlink" href="#id82" title="Permalink to this headline">¶</a></h4>
<p>/root/.ssh/config file</p>
</div>
<div class="section" id="id83">
<h4><span class="section-number">11.1.19.5. </span>Changelog<a class="headerlink" href="#id83" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.4: Add ssh ProxyJump capability for icebergs. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.3: Update to new network_interfaces syntax. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.2: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="ssh-slave">
<h3><span class="section-number">11.1.20. </span>SSH slave<a class="headerlink" href="#ssh-slave" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id84">
<h4><span class="section-number">11.1.20.1. </span>Description<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h4>
<p>This role configure the ssh client authorized public key.</p>
</div>
<div class="section" id="id85">
<h4><span class="section-number">11.1.20.2. </span>Instructions<a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h4>
<p>This role will ensure remote hosts is having currently defined ssh authorized public keys in their <em>/root/.ssh/authorized_keys</em> file.</p>
<p>These keys are set in file <em>group_vars/all/equipment_all/authentication.yml</em>.</p>
<p>Keep in mind that this file can be preceded with equipment_profiles groups.</p>
</div>
<div class="section" id="id86">
<h4><span class="section-number">11.1.20.3. </span>Input<a class="headerlink" href="#id86" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>authentication_ssh_keys</p></li>
</ul>
</div>
<div class="section" id="id87">
<h4><span class="section-number">11.1.20.4. </span>Output<a class="headerlink" href="#id87" title="Permalink to this headline">¶</a></h4>
<p>/root/.ssh/authorized_keys contains ssh public keys from inventory</p>
</div>
<div class="section" id="id88">
<h4><span class="section-number">11.1.20.5. </span>Changelog<a class="headerlink" href="#id88" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.2: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="time-server">
<h3><span class="section-number">11.1.21. </span>Time server<a class="headerlink" href="#time-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id89">
<h4><span class="section-number">11.1.21.1. </span>Description<a class="headerlink" href="#id89" title="Permalink to this headline">¶</a></h4>
<p>This role provides a time server/client based on Chrony.</p>
</div>
<div class="section" id="id90">
<h4><span class="section-number">11.1.21.2. </span>Instructions<a class="headerlink" href="#id90" title="Permalink to this headline">¶</a></h4>
<p>This role will react differently if in multi icebergs mode or not.</p>
<p>By default, in non multiple icebergs, server will be the time source reference.
If using multiple icebergs hierarchy, then server can be a time reference if at
top of the icebergs hierarchy, or simply a time relay with an higher stratum,
if not a top server. This stratum calculation is done using <strong>iceberg_level</strong>
variable defined in <strong>/etc/bluebanquise/inventory/cluster/icebergs/icebergX</strong>
files.</p>
<p>It is possible to configure external time sources for clients or servers in
<em>/etc/bluebanquise/inventory/group_vars/all/general_settings/external.yml</em>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">external_time</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
  <span class="l l-Scalar l-Scalar-Plain">time_server</span><span class="p p-Indicator">:</span>
    <span class="nt">pool</span><span class="p">:</span> <span class="c1"># List of possible time pools</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pool.ntp.org</span>
    <span class="nt">server</span><span class="p">:</span> <span class="c1"># List of possible time servers</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">0.pool.ntp.org</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1.pool.ntp.org</span>
<span class=" -Error">  </span><span class="nt">time_client</span><span class="p">:</span>
    <span class="nt">pool</span><span class="p">:</span>
    <span class="nt">server</span><span class="p">:</span>
</pre></div>
</div>
<p>If <strong>time_server</strong> is defined, the pool or server will be added in the server
configuration. If <strong>time_client</strong> is defined, the pool or server will be added
in the client configuration. It is possible to not install any time server but
simply bind to an external pool/server using this file.</p>
<p><strong>pool</strong> and <strong>servers</strong> are mutually exclusive. If you define both, the role
will default to <strong>pool</strong> to write the Chrony configuration.</p>
<p>In case of a need, to force time synchronization on client side, use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chronyc -a makestep
</pre></div>
</div>
</div>
<div class="section" id="id91">
<h4><span class="section-number">11.1.21.3. </span>Input<a class="headerlink" href="#id91" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>network_interfaces[item]</p></li>
<li><p>networks[item].prefix</p></li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>external_time</p></li>
<li><p>external_pool</p></li>
</ul>
</div>
<div class="section" id="id92">
<h4><span class="section-number">11.1.21.4. </span>Output<a class="headerlink" href="#id92" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>/etc/chrony.conf file</p></li>
<li><p>chrony package</p></li>
<li><p>time zone set from inventory</p></li>
</ul>
</div>
<div class="section" id="id93">
<h4><span class="section-number">11.1.21.5. </span>To be done<a class="headerlink" href="#id93" title="Permalink to this headline">¶</a></h4>
<p>Icebergs with stratum levels.</p>
</div>
<div class="section" id="id94">
<h4><span class="section-number">11.1.21.6. </span>Changelog<a class="headerlink" href="#id94" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.4: Add iburst to allow faster boot time recovery, update macro. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.3: Update to new network_interfaces syntax. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.2: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="advanced-core">
<h2><span class="section-number">11.2. </span>ADVANCED CORE<a class="headerlink" href="#advanced-core" title="Permalink to this headline">¶</a></h2>
<div class="section" id="advanced-dhcp-server">
<h3><span class="section-number">11.2.1. </span>Advanced DHCP server<a class="headerlink" href="#advanced-dhcp-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id95">
<h4><span class="section-number">11.2.1.1. </span>Description<a class="headerlink" href="#id95" title="Permalink to this headline">¶</a></h4>
<p>This role provides an advanced dhcp server combined with the iPXE roms of BlueBanquise.
Features like shared_network, opt82, opt61 or snp/snponly roms are provided here for very specific configurations or needs.</p>
</div>
<div class="section" id="id96">
<h4><span class="section-number">11.2.1.2. </span>Instructions<a class="headerlink" href="#id96" title="Permalink to this headline">¶</a></h4>
<p>Please read first documentation of the standard dhcp server role. Advanced dhcp
server provides same features than standard dhcp server role, but with more options.</p>
<p>Dhcp will only take into account networks from the current iceberg, and with naming related to administration network (by default iceX-Y).</p>
<p>Also, ensure dhcp is set to true for your network.</p>
<p>Finally, note that the following parameters can be set in the inventory, to
override default ones:</p>
<ul class="simple">
<li><p>advanced_dhcp_server_default_lease_time (default to 600)</p></li>
<li><p>advanced_dhcp_server_max_lease_time (default to 7200)</p></li>
</ul>
<p>Consider increasing the default values once your network is production ready.</p>
<div class="section" id="shared-network">
<h5><span class="section-number">11.2.1.2.1. </span><strong>Shared network</strong><a class="headerlink" href="#shared-network" title="Permalink to this headline">¶</a></h5>
<p>It is possible to combine networks into shared-networks when multiple subnets are on the same NIC, or when using opt82/option_match parameter.
To do so, add a variable in the network definition.</p>
<p>For example to add ice1-1 and ice1-2 into the same shared network, define them this way:</p>
<p>Ice1-1:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">networks</span><span class="p">:</span>
  <span class="nt">ice1-1</span><span class="p">:</span>
    <span class="nt">subnet</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.0</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">shared_network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wolf</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>And ice1-2:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">networks</span><span class="p">:</span>
  <span class="nt">ice1-2</span><span class="p">:</span>
    <span class="nt">subnet</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.30.0.0</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">shared_network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wolf</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>shared_network variable is optional and is simply ignored if not set.</p>
</div>
<div class="section" id="opt-61-and-opt-82">
<h5><span class="section-number">11.2.1.2.2. </span><strong>opt 61 and opt 82</strong><a class="headerlink" href="#opt-61-and-opt-82" title="Permalink to this headline">¶</a></h5>
<p>It is possible to use advanced dhcp features to identify an host. The following parameters are available, for the host and its BMC. Note that only one of these must be set for an host/BMC at the same time:</p>
<ul class="simple">
<li><p>mac: identify based on MAC address. Same than standard dhcp server.</p></li>
<li><p>dhcp_client_identifier: identify based on a patern (string, etc) to recognise an host. Also known as option 61.</p></li>
<li><p>host_identifier: identify based on an option (agent.circuit-id, agent.remote-id, etc) to recognize an host. Also known as option 82.</p></li>
<li><p>match: identify based on multiple options in combinaison to recognise an host. Also known as option 82 with hack.</p></li>
</ul>
<p>If using match, because this features is using a specific ‘hack’ in the dhcp server, you <strong>must</strong> define this host in a shared network, even if this shared network contains a single network (see this very well made page for more information: <a class="reference external" href="http://www.miquels.cistron.nl/isc-dhcpd/">http://www.miquels.cistron.nl/isc-dhcpd/</a>).</p>
</div>
</div>
<div class="section" id="id97">
<h4><span class="section-number">11.2.1.3. </span>Changelog<a class="headerlink" href="#id97" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.4: Update to new network_interfaces syntax. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.3: Added support of multiple DNS servers. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.0.2: Added Ubuntu 18.04 compatibility. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="advanced-dns-server">
<h3><span class="section-number">11.2.2. </span>Advanced DNS server<a class="headerlink" href="#advanced-dns-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id98">
<h4><span class="section-number">11.2.2.1. </span>Description<a class="headerlink" href="#id98" title="Permalink to this headline">¶</a></h4>
<p>This role provides an advanced dns server based on bind, and is expected to
provide more and more features.</p>
</div>
<div class="section" id="id99">
<h4><span class="section-number">11.2.2.2. </span>Instructions<a class="headerlink" href="#id99" title="Permalink to this headline">¶</a></h4>
<p>This DNS role will automatically add all networks of the cluster, assuming their
variable <strong>is_in_dns</strong> is set to true:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">networks</span><span class="p">:</span>
  <span class="nt">ice1-1</span><span class="p">:</span>
    <span class="nt">subnet</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.0</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">netmask</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">255.255.0.0</span>
    <span class="nt">broadcast</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.255.255</span>
    <span class="nt">is_in_dhcp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">is_in_dns</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
    <span class="nt">services_ip</span><span class="p">:</span>
      <span class="nt">dns_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.11.0.1</span>
</pre></div>
</div>
<p>It will generate 5 files:</p>
<ul class="simple">
<li><p>/etc/named.conf that contains main configuration, and that will try to bind to all networks defined on the host it is deployed on, using <strong>services_ip.dns_ip</strong> variable ip of the network.</p></li>
<li><p>/var/named/forward that contains forward resolution of hosts</p></li>
<li><p>/var/named/forward.soa included in /var/named/forward</p></li>
<li><p>/var/named/reverse that contains reverse resolution of hosts</p></li>
<li><p>/var/named/reverse.soa included in /var/named/reverse</p></li>
</ul>
<p>To configure forwarding and integrate this dns server into an existing IT
configuration, use file <em>group_vars/all/general_settings/external.yml</em>.
It is possible to add here an external dns to bind to for this internal dns, as
a relay.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">external_dns</span><span class="p">:</span>
  <span class="nt">dns_server</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
    <span class="l l-Scalar l-Scalar-Plain">- 208.67.222.222</span>
</pre></div>
</div>
</div>
<div class="section" id="id100">
<h4><span class="section-number">11.2.2.3. </span>Input<a class="headerlink" href="#id100" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>domain_name</p></li>
<li><dl class="simple">
<dt>network[item]</dt><dd><ul>
<li><p>.services_ip.dns_ip</p></li>
<li><p>.subnet</p></li>
<li><p>.prefix</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>network_interfaces</dt><dd><ul>
<li><p>.ip4</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>hostvars[host]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>network_interfaces</dt><dd><ul>
<li><p>.ip4</p></li>
<li><p>.mac</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>dns_master</p></li>
<li><p>dns_slaves</p></li>
<li><p>external_dns.dns_server</p></li>
</ul>
<p><strong>hostvars[hosts]</strong></p>
<ul class="simple">
<li><p>alias</p></li>
<li><dl class="simple">
<dt>bmc</dt><dd><ul>
<li><p>.ip4</p></li>
<li><p>.mac</p></li>
<li><p>.name</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id101">
<h4><span class="section-number">11.2.2.4. </span>Output<a class="headerlink" href="#id101" title="Permalink to this headline">¶</a></h4>
<p>Packages installed:</p>
<ul class="simple">
<li><p>bind dns server</p></li>
</ul>
<p>Files generated:</p>
<ul class="simple">
<li><p>/etc/named.conf</p></li>
<li><p>/var/named/forward</p></li>
<li><p>/var/named/reverse</p></li>
<li><p>/var/named/forward.soa</p></li>
<li><p>/var/named/reverse.soa</p></li>
</ul>
</div>
<div class="section" id="id102">
<h4><span class="section-number">11.2.2.5. </span>Changelog<a class="headerlink" href="#id102" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.1.2: Moved role to advanced core. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.1.1: Clean. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.1.0: Added DNS slaves support. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.0.2: Added Ubuntu 18.04 compatibility. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="addons">
<h2><span class="section-number">11.3. </span>ADDONS<a class="headerlink" href="#addons" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cloning">
<h3><span class="section-number">11.3.1. </span>Cloning<a class="headerlink" href="#cloning" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id103">
<h4><span class="section-number">11.3.1.1. </span>Description<a class="headerlink" href="#id103" title="Permalink to this headline">¶</a></h4>
<p>This role provides ipxe files for Clonezilla live usage.</p>
</div>
<div class="section" id="id104">
<h4><span class="section-number">11.3.1.2. </span>Instructions<a class="headerlink" href="#id104" title="Permalink to this headline">¶</a></h4>
<p>You first need to enable cloning entries in the ipxe menu of the <strong>pxe_stack</strong>
role. To do so, set variable <em>pxe_stack_enable_cloning</em> to <strong>true</strong> in your
inventory. Then re-execute the pxe_stack role to apply changes.</p>
<p>The Clonezilla Live iso is needed for this role to run properly. The following
iso version was used for validating this role:
<strong>clonezilla-live-20191024-eoan-amd64.iso</strong></p>
<p>The iso must be mounted in the <em>preboot_execution_environment/clone/clonezilla</em>
folder or the content copied inside this directory.</p>
<p>Call bootset using <em>-b clone -i myimage</em> to clone a node into <em>myimage</em>, and
<em>-b deploy_clone -i myimage</em> to deploy <em>myimage</em> on the target node.</p>
<p>By default, sda device is targeted, and clone parameters are:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ocs-sr -q2 -batch -j2 -z1 -i 2096 -fsck-src-part-y -senc -p reboot savedisk myimage.img sda
</pre></div>
</div>
<p>It is possible to force other clone parameters by setting extra-parameters
during bootset invocation. For example, to clone sdb disk, use:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bootset -n mynode -i myimage -b clone -e &quot;ocs-sr -q2 -batch -j2 -z1 -i 2096 -fsck-src-part-y -senc -p reboot savedisk myimage.img sdb&quot;
</pre></div>
</div>
<p>Refer to Clonezilla live documentation about other parameters.</p>
<p>Same apply to deploy clone. By Default, sda is targeted, and restore clone
parameters are:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ocs-sr -g auto -e1 auto -e2 -r -j2 -batch -p reboot restoredisk myimage.img sda
</pre></div>
</div>
<p>It is possible to replace these parameters using extra parameters when invoking
bootset.</p>
</div>
<div class="section" id="id105">
<h4><span class="section-number">11.3.1.3. </span>Changelog<a class="headerlink" href="#id105" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="clustershell">
<h3><span class="section-number">11.3.2. </span>ClusterShell<a class="headerlink" href="#clustershell" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id106">
<h4><span class="section-number">11.3.2.1. </span>Description<a class="headerlink" href="#id106" title="Permalink to this headline">¶</a></h4>
<p>This role provides clustershell and groups for clustershell (based on Ansible groups).</p>
</div>
<div class="section" id="id107">
<h4><span class="section-number">11.3.2.2. </span>Instructions<a class="headerlink" href="#id107" title="Permalink to this headline">¶</a></h4>
<p>Check groups using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nodeset -LL
</pre></div>
</div>
</div>
<div class="section" id="id108">
<h4><span class="section-number">11.3.2.3. </span>To be done<a class="headerlink" href="#id108" title="Permalink to this headline">¶</a></h4>
<p>Tree execution mode is missing.</p>
</div>
<div class="section" id="id109">
<h4><span class="section-number">11.3.2.4. </span>Changelog<a class="headerlink" href="#id109" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.1: Fixed bad template. Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="diskless">
<h3><span class="section-number">11.3.3. </span>Diskless<a class="headerlink" href="#diskless" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id110">
<h4><span class="section-number">11.3.3.1. </span>Description<a class="headerlink" href="#id110" title="Permalink to this headline">¶</a></h4>
<p>This role provides needed tools to deploy a basic diskless cluster.</p>
<p>Two type of images are available:</p>
<ul class="simple">
<li><p>Livenet images are full ram images, without persistance but need less infrastructure.</p></li>
<li><p>NFS images are full nfs rw images, with psersistance, very simple to use, but need more infrastructure.</p></li>
</ul>
<p>It is important to understand that this role is independant of the pxe_stack core role, and so each tools do not communicate.</p>
<p>Validated on RHEL8.</p>
</div>
<div class="section" id="basic-instructions">
<h4><span class="section-number">11.3.3.2. </span>Basic instructions<a class="headerlink" href="#basic-instructions" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>Apply your playbook with the “diskless” role activated (see <em>Example playbook</em> part):</p></li>
<li><p>Copy the kernels in /boot you want to use for your images.</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cp /boot/vmlinuz-&lt;kernel releases to use for diskless nodes&gt; \
   /var/www/html/preboot_execution_environment/diskless/kernels/
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Launch <em>disklessset</em> and verify that the kernels are present in the tool, then quit.</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># disklessset
BlueBanquise Diskless manager
 1 - List available kernels
 2 - Generate a new initramfs
 3 - Generate a new diskless image
 4 - Manage existing diskless images
--&gt;: 1
[INFO] Loading kernels from /var/www/html/preboot_execution_environment/diskless/kernels/

Available kernels:
  │
  └── vmlinuz-4.18.0-193.6.3.el8_2.x86_64 - missing initramfs-kernel-4.18.0-193.6.3.el8_2.x86_64
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Launch <em>disklessset</em> and ask an initramfs creation for this kernel</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># disklessset
BlueBanquise Diskless manager
 1 - List available kernels
 2 - Generate a new initramfs
 3 - Generate a new diskless image
 4 - Manage existing diskless images
--&gt;: 2
[INFO] Loading kernels from /var/www/html/preboot_execution_environment/diskless/kernels/

Select kernel:
 1 - vmlinuz-4.18.0-193.6.3.el8_2.x86_64
--&gt;: 1
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Using <em>disklessset</em>, verify that this creation went well: “initiramfs present” must now be present after the kernel.</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># disklessset
BlueBanquise Diskless manager
 1 - List available kernels
 2 - Generate a new initramfs
 3 - Generate a new diskless image
 4 - Manage existing diskless images
--&gt;: 1
[INFO] Loading kernels from /var/www/html/preboot_execution_environment/diskless/kernels/

Available kernels:
    │
    └── vmlinuz-4.18.0-193.6.3.el8_2.x86_64 - initramfs present
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Launch <em>disklessset</em> and create the livenet image. The command will guide you from here.</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># disklessset
BlueBanquise Diskless manager
 1 - List available kernels
 2 - Generate a new initramfs
 3 - Generate a new diskless image
 4 - Manage existing diskless images
--&gt;: 3

Starting new image creation phase.
Many questions will be asked, a recap will be provided before starting procedure.
</pre></div>
</div>
<p>Select livenet image:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Select image type:
 1 - nfs
 2 - livenet
--&gt;: 2
[INFO] Loading kernels from /var/www/html/preboot_execution_environment/diskless/kernels/
</pre></div>
</div>
<p>Select the kernel you want to use wit this image from the list of available kernels:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Select kernel:
 1 - vmlinuz-4.18.0-193.6.3.el8_2.x86_64
--&gt;: 1
Please enter image name ?
--&gt;: livenet1
Please enter clear root password of the new image: &lt;password&gt;
[INFO] Entering livenet dedicated part.
</pre></div>
</div>
<p>Choose a standard image, and give a size.</p>
<p>Proposal:</p>
<ul class="simple">
<li><p>The size recommended for the Standard or Custom profile is 5G.</p></li>
<li><dl class="simple">
<dt>The size of the final image booted and loaded in RAM is approximately :</dt><dd><ul>
<li><p>1.2GB for Standard image</p></li>
<li><p>250MB for Small image</p></li>
<li><p>130MB for Minimal image</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Important:</p>
<ul class="simple">
<li><p>The option 4 allows you to install additional packages.</p></li>
<li><p>If you want to install drivers or Interconnect Stack (Nvidia, Mellanox OFED,…) you must use option 4 and specify the package kernel-modules.</p></li>
<li><p>To specify multiple packages, separate them with spaces, example: kernel-modules kernel kernel-devel nvidia-cuda</p></li>
<li><p>With option 4, specify the packages version. Example: kernel-modules-4.18.0-193.6.3 kernel-4.18.0-193.6.3 kernel-devel-4.18.0-193.6.3</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Please select livenet image generation profile:
 1 - Standard: core
 2 - Small: openssh, dnf and NetworkManager
 3 - Minimal: openssh only
 4 - Custom: core + selection of additional packages

--&gt;: 1
Please choose image size:
(supported units: M=1024*1024, G=1024*1024*1024)
(Example: 5120M or 5G)
--&gt;: 5G
Enter path to SSH public key (left empty to disable key injection):
--&gt;: /root/.ssh/id_rsa.pub
Do you want to activate SELinux inside the image?
Enter yes or no: no
</pre></div>
</div>
<p>Check that everything is alright before continuing:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Do you want to create a new livenet image with the following parameters:
  Image name:           livenet1
  Kernel version:       vmlinuz-4.18.0-193.6.3.el8_2.x86_64
  Root password:        root
  Image profile:        1
  Image size:           5120M
  SSH pubkey:           /root/.ssh/id_rsa.pub
  Enable SELinux:       no
Confirm ? Enter yes or no: yes
[INFO] Cleaning and creating image folders.
[INFO] Generating new ipxe boot file.
[INFO] Creating empty image file, format and mount it.
5242880+0 records in
5242880+0 records out
5368709120 bytes (5.4 GB, 5.0 GiB) copied, 10.3195 s, 520 MB/s
meta-data=/var/tmp/diskless/workdir/livenet1/LiveOS/rootfs.img isize=512    agcount=4, agsize=327680 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1
data     =                       bsize=4096   blocks=1310720, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[INFO] Generating cache link for dnf.
[INFO] Installing system into image.
...
</pre></div>
</div>
<p>Image is now generated.</p>
<ol class="arabic simple" start="7">
<li><p>(Optionnal) See Customizing Livenet image in next section on how to customize image before using it.</p></li>
<li><p>Using the command <em>bootset</em>, set the image one node will use.</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># bootset -n c001 -b diskless -i livenet1
</pre></div>
</div>
<p>The -n parameter can be a nodeset.</p>
<ol class="arabic simple" start="9">
<li><p>Reboot the diskless node to make it boot onto the new image.</p></li>
<li><p>Once the nodes are booted, run the entire computes playbook.
If you have used <strong>Customizing Livenet image</strong> (see below), run the
playbook with ‘nic’ and ‘set_hostname’ roles only.</p></li>
</ol>
</div>
<div class="section" id="customizing-livenet-image">
<h4><span class="section-number">11.3.3.3. </span>Customizing Livenet image<a class="headerlink" href="#customizing-livenet-image" title="Permalink to this headline">¶</a></h4>
<p>The image name used in the examples below is <em>space_image</em>.</p>
<p>The disklessset tool allows to customize livenet images before booting them,
by mounting images and providing simple chroot inventory. System administrator
can then tune or execute playbooks inside images.
This step also saves time on the execution of playbooks on booted diskless nodes.</p>
<p>Start the tool, select menu “4 - Manage existing diskless images”, then
“5 - Manage livenet images”.</p>
<p>The next menu allows you to mount, unmount, or resize image.</p>
<p>Mount the image first. Images are mounted in
/var/tmp/diskless/workdir/space_image/mnt.</p>
<p>It is now possible to copy files, install rpms, or tune any aspects of the
mounted image.</p>
<p>The tool also generated a temporary Ansible inventory in
/var/tmp/diskless/workdir/space_image/inventory/ .</p>
<p>To execute an Ansible playbook into the image, generate a new playbook
with the following head:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Computes diskless playbook</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/tmp/diskless/workdir/{{ image_name }}/mnt</span>
  <span class="nt">connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chroot</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">j2_current_iceberg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">iceberg1</span>                <span class="c1">#&lt;&lt;&lt; UPDATE IF NEEDED</span>
    <span class="nt">j2_node_main_network</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ice1-1</span>                <span class="c1">#&lt;&lt;&lt; UPDATE</span>
    <span class="nt">start_service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">image_equipment_profile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">equipment_typeC</span>    <span class="c1">#&lt;&lt;&lt; UPDATE</span>

  <span class="nt">pre_tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Add current host to defined equipment_profile</span>
      <span class="nt">add_host</span><span class="p">:</span>
        <span class="nt">hostname</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">groups</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">image_equipment_profile</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">tags</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">always</span>

  <span class="nt">roles</span><span class="p">:</span>
  <span class="c1"># ADD HERE YOUR ROLES</span>
</pre></div>
</div>
<p>Now, update the needed values in this file:</p>
<ul class="simple">
<li><p><strong>j2_current_iceberg</strong>: Except if you are using multiple icebergs advanced feature, you should let this to <cite>iceberg1</cite>.</p></li>
<li><p><strong>j2_node_main_network</strong>: Set here your main network to be used. This will allow the roles to determine the services ip to bind to.</p></li>
<li><p><strong>image_equipment_profile</strong>: Set here your equipment_profile to be used. This will allow the roles to determine key values, for example find the repositories path to be used (distribution version, etc).</p></li>
</ul>
<p>And add your desired roles under <strong>roles:</strong> in the file, like for
any standard playbook.</p>
<p>Then execute it into the mounted image using the following command:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ansible-playbook computes.yml \
-i /etc/bluebanquise/inventory/ -i /etc/bluebanquise/internal/ -i /var/tmp/diskless/workdir/space_image/inventory/ \
--skip-tags identify -e &quot;image_name=space_image&quot;
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p>The multiple <cite>-i</cite> defines Ansible inventories to gather. By default, in BlueBanquise, the first two inventories are used. We simply add the third one, corresponding to the mounting point.</p></li>
<li><p>The <cite>-e</cite> (extra vars) are here to specify to the stack which iceberg and main network are to be used in the configuration of the node. (System cannot know on which nodes the image will be used).</p></li>
<li><p>The <cite>–skip-tags identify</cite> prevents hostname and static ip to be set, since the image should be generic for multiple hosts.</p></li>
</ul>
<p>Before closing, also remember to clean dnf cache into the image chroot to save space.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># dnf clean all --installroot /var/tmp/diskless/workdir/space_image/mnt/
</pre></div>
</div>
<p>Now, using df command, check used space of the image, to resize it later if whished.</p>
<p>Using disklessset now, choose option 2 to unmount the image and squashfs it again.</p>
<p>It is possible now to use the tool to resize image, to reduce it to the desired value (to save ram on target host).
Always keep at least 100MB in / for temporary files and few logs generated during run.</p>
</div>
<div class="section" id="example-playbook">
<h4><span class="section-number">11.3.3.4. </span>Example Playbook<a class="headerlink" href="#example-playbook" title="Permalink to this headline">¶</a></h4>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>- hosts: mngt0-1
  roles:
    - pxe_stack
    - diskless
</pre></div>
</div>
<p>Once the node is started, run your playbook with your roles.
It is important to synchronize your node’s time by running the time role.</p>
</div>
<div class="section" id="id111">
<h4><span class="section-number">11.3.3.5. </span>To be done<a class="headerlink" href="#id111" title="Permalink to this headline">¶</a></h4>
<p>Clean code, add more error detection, and more verbosity.</p>
</div>
<div class="section" id="id112">
<h4><span class="section-number">11.3.3.6. </span>Changelog<a class="headerlink" href="#id112" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.1.0: Role update. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;, Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="ofed">
<h3><span class="section-number">11.3.4. </span>OFED<a class="headerlink" href="#ofed" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id113">
<h4><span class="section-number">11.3.4.1. </span>Description<a class="headerlink" href="#id113" title="Permalink to this headline">¶</a></h4>
<p>This role install and start all needed for OFED based interconnects (Mellanox, etc.).</p>
</div>
<div class="section" id="id114">
<h4><span class="section-number">11.3.4.2. </span>Instructions<a class="headerlink" href="#id114" title="Permalink to this headline">¶</a></h4>
<p>Only for Centos/Rhel.</p>
</div>
<div class="section" id="id115">
<h4><span class="section-number">11.3.4.3. </span>To be done<a class="headerlink" href="#id115" title="Permalink to this headline">¶</a></h4>
<p>Need to add support for Ubuntu and OpenSuse if exist.</p>
</div>
<div class="section" id="id116">
<h4><span class="section-number">11.3.4.4. </span>Changelog<a class="headerlink" href="#id116" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="ofed-sm">
<h3><span class="section-number">11.3.5. </span>OFED_SM<a class="headerlink" href="#ofed-sm" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id117">
<h4><span class="section-number">11.3.5.1. </span>Description<a class="headerlink" href="#id117" title="Permalink to this headline">¶</a></h4>
<p>This role install and start all needed for OFED subnet manager.</p>
</div>
<div class="section" id="id118">
<h4><span class="section-number">11.3.5.2. </span>Instructions<a class="headerlink" href="#id118" title="Permalink to this headline">¶</a></h4>
<p>Only for Centos/Rhel.</p>
</div>
<div class="section" id="id119">
<h4><span class="section-number">11.3.5.3. </span>To be done<a class="headerlink" href="#id119" title="Permalink to this headline">¶</a></h4>
<p>Need to add support for Ubuntu and OpenSuse if exist.</p>
</div>
<div class="section" id="id120">
<h4><span class="section-number">11.3.5.4. </span>Changelog<a class="headerlink" href="#id120" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="openldap-client">
<h3><span class="section-number">11.3.6. </span>OpenLDAP client<a class="headerlink" href="#openldap-client" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id121">
<h4><span class="section-number">11.3.6.1. </span>Description<a class="headerlink" href="#id121" title="Permalink to this headline">¶</a></h4>
<p>This role provides a basic but UNSECURE ldap client based on SSSD.</p>
</div>
<div class="section" id="id122">
<h4><span class="section-number">11.3.6.2. </span>Instructions<a class="headerlink" href="#id122" title="Permalink to this headline">¶</a></h4>
<p>NA</p>
</div>
<div class="section" id="id123">
<h4><span class="section-number">11.3.6.3. </span>To be done<a class="headerlink" href="#id123" title="Permalink to this headline">¶</a></h4>
<p>Enable encryption to secure this role.</p>
</div>
<div class="section" id="id124">
<h4><span class="section-number">11.3.6.4. </span>Changelog<a class="headerlink" href="#id124" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.1: Fixed bad template. Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="openldap-server">
<h3><span class="section-number">11.3.7. </span>OpenLDAP server<a class="headerlink" href="#openldap-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id125">
<h4><span class="section-number">11.3.7.1. </span>Description<a class="headerlink" href="#id125" title="Permalink to this headline">¶</a></h4>
<p>This role provides a basic but UNSECURE ldap server. It also provides phpldapadmin configuration to manage LDAP.</p>
</div>
<div class="section" id="id126">
<h4><span class="section-number">11.3.7.2. </span>Instructions<a class="headerlink" href="#id126" title="Permalink to this headline">¶</a></h4>
<p>Login into <a class="reference external" href="http://localhost/phpldapadmin">http://localhost/phpldapadmin</a> to manage LDAP.</p>
<p>Keep in mind this role is for the time being unsecure.</p>
</div>
<div class="section" id="id127">
<h4><span class="section-number">11.3.7.3. </span>To be done<a class="headerlink" href="#id127" title="Permalink to this headline">¶</a></h4>
<p>Enable encryption to secure this role.</p>
</div>
<div class="section" id="id128">
<h4><span class="section-number">11.3.7.4. </span>Changelog<a class="headerlink" href="#id128" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.1: Fixed bad template. Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="nic-with-nmcli">
<h3><span class="section-number">11.3.8. </span>NIC with nmcli<a class="headerlink" href="#nic-with-nmcli" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id129">
<h4><span class="section-number">11.3.8.1. </span>Description<a class="headerlink" href="#id129" title="Permalink to this headline">¶</a></h4>
<p>This role configure network interfaces to provide desired ip, prefix, gateway, etc.</p>
<p>This role is still under work, as nmcli is not supported in RHEL 8 for now, and that this role need to handle much more features.</p>
</div>
<div class="section" id="id130">
<h4><span class="section-number">11.3.8.2. </span>Instructions<a class="headerlink" href="#id130" title="Permalink to this headline">¶</a></h4>
<p>NA</p>
</div>
<div class="section" id="id131">
<h4><span class="section-number">11.3.8.3. </span>To be done<a class="headerlink" href="#id131" title="Permalink to this headline">¶</a></h4>
<p>Add more features, as nmcli Ansible module can do much more.</p>
<ul class="simple">
<li><p>VLANs</p></li>
<li><p>LACP/Bond</p></li>
<li><p>Non network linked NIC</p></li>
<li><p>Multi IP</p></li>
</ul>
</div>
<div class="section" id="id132">
<h4><span class="section-number">11.3.8.4. </span>Changelog<a class="headerlink" href="#id132" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.2: Adding Ubuntu 18.04 compatibility. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="powerman">
<h3><span class="section-number">11.3.9. </span>Powerman<a class="headerlink" href="#powerman" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id133">
<h4><span class="section-number">11.3.9.1. </span>Description<a class="headerlink" href="#id133" title="Permalink to this headline">¶</a></h4>
<p>This role provides powerman, to manage nodes power via ipmi (BMC).</p>
</div>
<div class="section" id="id134">
<h4><span class="section-number">11.3.9.2. </span>Instructions<a class="headerlink" href="#id134" title="Permalink to this headline">¶</a></h4>
<p>To power on node, use:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>powerman --on bar,foo[7,9-10]
</pre></div>
</div>
<p>Refer to: <a class="reference external" href="https://linux.die.net/man/1/powerman">https://linux.die.net/man/1/powerman</a></p>
</div>
<div class="section" id="id135">
<h4><span class="section-number">11.3.9.3. </span>Input<a class="headerlink" href="#id135" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>icebergs_system</p></li>
</ul>
<p><strong>hostvars[hosts]</strong></p>
<ul class="simple">
<li><p>ep_equipment_authentication.user</p></li>
<li><p>ep_equipment_authentication.password</p></li>
<li><dl class="simple">
<dt>bmc</dt><dd><ul>
<li><p>.name</p></li>
<li><p>.ip4</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id136">
<h4><span class="section-number">11.3.9.4. </span>Output<a class="headerlink" href="#id136" title="Permalink to this headline">¶</a></h4>
<p>Packages installed:</p>
<ul class="simple">
<li><p>powerman</p></li>
<li><p>freeipmi</p></li>
</ul>
<p>Files generated:</p>
<ul class="simple">
<li><p>/etc/powerman/powerman.conf</p></li>
</ul>
</div>
<div class="section" id="id137">
<h4><span class="section-number">11.3.9.5. </span>Changelog<a class="headerlink" href="#id137" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="prometheus-server">
<h3><span class="section-number">11.3.10. </span>Prometheus server<a class="headerlink" href="#prometheus-server" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id138">
<h4><span class="section-number">11.3.10.1. </span>Description<a class="headerlink" href="#id138" title="Permalink to this headline">¶</a></h4>
<p>This role deploy prometheus server with alertmanager.</p>
</div>
<div class="section" id="id139">
<h4><span class="section-number">11.3.10.2. </span>Instructions<a class="headerlink" href="#id139" title="Permalink to this headline">¶</a></h4>
<div class="section" id="default-ports">
<h5><span class="section-number">11.3.10.2.1. </span>Default ports<a class="headerlink" href="#default-ports" title="Permalink to this headline">¶</a></h5>
<p>Prometheus is available at <a class="reference external" href="http://localhost:9090">http://localhost:9090</a></p>
<p>Alertmanager is available at <a class="reference external" href="http://localhost:9093">http://localhost:9093</a></p>
<p>Node_exporter is available at <a class="reference external" href="http://localhost:9100">http://localhost:9100</a></p>
</div>
<div class="section" id="general-configuration">
<h5><span class="section-number">11.3.10.2.2. </span>General configuration<a class="headerlink" href="#general-configuration" title="Permalink to this headline">¶</a></h5>
<p>By default, role will inherit from values set in its defaults folder.
You may wish to update these values to your needs, as these values set the
different timings used by Prometheus.</p>
<p>To do so, create file inventory/group_vars/all/addons/prometheus.yml with the
following content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">prometheus</span><span class="p">:</span>
  <span class="nt">scrape_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1m</span>
  <span class="nt">evaluation_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2m</span>
  <span class="nt">alertmanager</span><span class="p">:</span>
    <span class="nt">group_wait</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1m</span>
    <span class="nt">group_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10m</span>
    <span class="nt">repeat_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3h</span>
</pre></div>
</div>
<p>And tune according to your needs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The prometheus_server role will try to read the prometheus_client
related files, to generate its configuration (register exporters to scrape for
each equipment profile group of nodes). See the prometheus_client role
documentation for more details.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config</a></p></li>
<li><p><a class="reference external" href="https://www.robustperception.io/whats-the-difference-between-group_interval-group_wait-and-repeat_interval">https://www.robustperception.io/whats-the-difference-between-group_interval-group_wait-and-repeat_interval</a></p></li>
</ul>
</div>
</div>
<div class="section" id="alerting">
<h5><span class="section-number">11.3.10.2.3. </span>Alerting<a class="headerlink" href="#alerting" title="Permalink to this headline">¶</a></h5>
<p>By default, the role will only add a simple alerts file into the
/etc/prometheus/alerts folder. This file contains a basic alert that fire when
an exporter is down.</p>
<p>You will probably wish to add more alerts. Few alerts are proposed by the stack,
and are provided as examples in the /usr/share/doc/bluebanquise/prometheus/
folder.</p>
<p>You can simply copy the whole files that are needed, or a part of them, and tune
them according to your needs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When possible, we added our references from the web inside the example files.</p>
</div>
</div>
</div>
<div class="section" id="id140">
<h4><span class="section-number">11.3.10.3. </span>To be done<a class="headerlink" href="#id140" title="Permalink to this headline">¶</a></h4>
<p>Allow groups alerts selection.</p>
</div>
<div class="section" id="id141">
<h4><span class="section-number">11.3.10.4. </span>Changelog<a class="headerlink" href="#id141" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="prometheus-client">
<h3><span class="section-number">11.3.11. </span>Prometheus client<a class="headerlink" href="#prometheus-client" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id142">
<h4><span class="section-number">11.3.11.1. </span>Description<a class="headerlink" href="#id142" title="Permalink to this headline">¶</a></h4>
<p>This role deploy exporters on clients for Prometheus queries.</p>
</div>
<div class="section" id="id143">
<h4><span class="section-number">11.3.11.2. </span>Instructions<a class="headerlink" href="#id143" title="Permalink to this headline">¶</a></h4>
<p>Each role has its own http port. For example, Node_exporter is available at
<a class="reference external" href="http://localhost:9100">http://localhost:9100</a> .</p>
<p>In order for this role to install and start exporters on the host, a
configuration is required in the Ansible inventory.</p>
<p>A file is needed for each equipment_profile group that should be monitored.</p>
<p>For example, to have equipment_typeC nodes installing and testing the
node_exporter, you will need to create file
inventory/group_vars/equipment_typeC/monitoring.yml with the following content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">monitoring</span><span class="p">:</span>
  <span class="nt">exporters</span><span class="p">:</span>
    <span class="nt">node_exporter</span><span class="p">:</span>
      <span class="nt">package</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node_exporter</span>
      <span class="nt">service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node_exporter</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9100</span>
</pre></div>
</div>
<p>And for example, on your management nodes, you may wish to have more exporters
setup to monitor much more things. This would be here, assuming managements
nodes are from equipment group equipment_typeM, a file
inventory/group_vars/equipment_typeM/monitoring.yml with the following content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">monitoring</span><span class="p">:</span>
  <span class="nt">exporters</span><span class="p">:</span>
    <span class="nt">node_exporter</span><span class="p">:</span>
      <span class="nt">package</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node_exporter</span>
      <span class="nt">service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node_exporter</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9100</span>
    <span class="nt">ha_cluster_exporter</span><span class="p">:</span>
      <span class="nt">package</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ha_cluster_exporter</span>
      <span class="nt">service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ha_cluster_exporter</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9664</span>
    <span class="nt">slurm_exporter</span><span class="p">:</span>
      <span class="nt">package</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">slurm_exporter</span>
      <span class="nt">service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">slurm_exporter</span>
      <span class="nt">scrape_interval</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5m</span>
      <span class="nt">scrape_timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5m</span>
      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">9817</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>ha_cluster_exporter and slurm_exporter are documented in the stack, but no
packages are provided by the BlueBanquise project. Refer to the monitoring
documentation to get additional details about these exporters.</p>
</div>
<p>You can see here that it is possible to customize the scrape_interval and
scrape_timeout.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the ipmi_exporter and snmp_exporter do not need to be included here
as their behavior are different (they act as relay for other targets) and so are
directly deployed by the prometheus_server role.</p>
</div>
</div>
<div class="section" id="id144">
<h4><span class="section-number">11.3.11.3. </span>To be done<a class="headerlink" href="#id144" title="Permalink to this headline">¶</a></h4>
<p>Allow groups alerts selection.</p>
</div>
<div class="section" id="id145">
<h4><span class="section-number">11.3.11.4. </span>Changelog<a class="headerlink" href="#id145" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="grafana">
<h3><span class="section-number">11.3.12. </span>Grafana<a class="headerlink" href="#grafana" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id146">
<h4><span class="section-number">11.3.12.1. </span>Description<a class="headerlink" href="#id146" title="Permalink to this headline">¶</a></h4>
<p>This role deploys grafana on the host.</p>
</div>
<div class="section" id="id147">
<h4><span class="section-number">11.3.12.2. </span>Instructions<a class="headerlink" href="#id147" title="Permalink to this headline">¶</a></h4>
<p>Grafana is available at <a class="reference external" href="http://localhost:3000">http://localhost:3000</a></p>
</div>
<div class="section" id="id148">
<h4><span class="section-number">11.3.12.3. </span>Changelog<a class="headerlink" href="#id148" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.0: Role creation. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="report">
<h3><span class="section-number">11.3.13. </span>Report<a class="headerlink" href="#report" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id149">
<h4><span class="section-number">11.3.13.1. </span>Description<a class="headerlink" href="#id149" title="Permalink to this headline">¶</a></h4>
<p>This role try to provide sys admin few useful tools.</p>
<ul class="simple">
<li><p>An automatic known issue paterns checker for the stack</p></li>
<li><p>Many visual reports (inventory, playbooks, network, facts)</p></li>
</ul>
</div>
<div class="section" id="id150">
<h4><span class="section-number">11.3.13.2. </span>Instructions<a class="headerlink" href="#id150" title="Permalink to this headline">¶</a></h4>
<p>Report is available at <a class="reference external" href="http://localhost/report/index.html">http://localhost/report/index.html</a></p>
</div>
<div class="section" id="id151">
<h4><span class="section-number">11.3.13.3. </span>To be done<a class="headerlink" href="#id151" title="Permalink to this headline">¶</a></h4>
<p>Many things…</p>
</div>
<div class="section" id="id152">
<h4><span class="section-number">11.3.13.4. </span>Changelog<a class="headerlink" href="#id152" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.1: Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="root-password">
<h3><span class="section-number">11.3.14. </span>Root password<a class="headerlink" href="#root-password" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id153">
<h4><span class="section-number">11.3.14.1. </span>Description<a class="headerlink" href="#id153" title="Permalink to this headline">¶</a></h4>
<p>This role updates the root password on the target hosts.</p>
</div>
<div class="section" id="id154">
<h4><span class="section-number">11.3.14.2. </span>Instructions<a class="headerlink" href="#id154" title="Permalink to this headline">¶</a></h4>
<p>The root password must be defined in the inventory:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">authentication_root_password_sha512</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$6$M3crarMVoUV3rALd$ZTre2CIyss7zOb4lkLoG23As9OAkYPw2BM88Y1F43n8CCyV5XWwAYEwBOrS8bcCBIMjIPdJG.ndOfzWyAVR4j0</span>
</pre></div>
</div>
<p>To generate an sha512 password, use the following command (python &gt;3.3):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>python -c &#39;import crypt,getpass; print(crypt.crypt(getpass.getpass(), crypt.mksalt(crypt.METHOD_SHA512)))&#39;
</pre></div>
</div>
</div>
<div class="section" id="id155">
<h4><span class="section-number">11.3.14.3. </span>Input<a class="headerlink" href="#id155" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>authentication_root_password_sha512</p></li>
</ul>
</div>
<div class="section" id="id156">
<h4><span class="section-number">11.3.14.4. </span>Changelog<a class="headerlink" href="#id156" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.0: Role creation. Bruno Travouillon &lt;<a class="reference external" href="mailto:devel&#37;&#52;&#48;travouillon&#46;fr">devel<span>&#64;</span>travouillon<span>&#46;</span>fr</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="singularity">
<h3><span class="section-number">11.3.15. </span>Singularity<a class="headerlink" href="#singularity" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id157">
<h4><span class="section-number">11.3.15.1. </span>Description<a class="headerlink" href="#id157" title="Permalink to this headline">¶</a></h4>
<p>Install and configure Singularity or SingularityPRO.</p>
</div>
<div class="section" id="pre-requisites">
<h4><span class="section-number">11.3.15.2. </span>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>RPMs of Singularity</p></li>
</ul>
<p>Note: RPM is not directly available on Singularity GitHub.
RHEL8 build instructions (example done on management1, but can be done on
another RHEL8 server** anywhere)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>dnf groupinstall -y &#39;Development Tools&#39;
dnf install openssl-devel libuuid-devel libseccomp-devel wget squashfs-tools cryptsetup golang createrepo
rpmbuild -tb singularity-3.6.3.tar.gz
mkdir /var/www/html/repositories/centos/8/x86_64/singularity
cp /root/rpmbuild/RPMS/x86_64/singularity-3.6.3-1.el8.x86_64.rpm /var/www/html/repositories/centos/8/x86_64/singularity/.
cd /var/www/html/repositories/centos/8/x86_64/singularity &amp;&amp; createrepo .
</pre></div>
</div>
<p>or</p>
<ul class="simple">
<li><p>RPMs of SingularityPRO</p></li>
</ul>
<p>Note: Sylabs is <strong>NOT</strong> providing a public repository for its RPMs, but is
sending a private repository URL once the software has been bought.
You must first manually download the RPMs using the link provided in the email,
and put them on the server before executing this playbook.</p>
<p>In all cases, it would be also necessary to run the <cite>repositories_client</cite> role
in order to correctly setup the built or downloaded RPMs.</p>
</div>
<div class="section" id="usage">
<h4><span class="section-number">11.3.15.3. </span>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h4>
<p>Playbook example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">repositories client</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="s">&quot;mg_managements,mg_computes&quot;</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">repositories_client</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">repositories</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">singularity</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">addons roles to run everywhere</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="s">&quot;mg_computes&quot;</span>
  <span class="nt">roles</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">singularity</span>
</pre></div>
</div>
</div>
<div class="section" id="id158">
<h4><span class="section-number">11.3.15.4. </span>ChangeLog<a class="headerlink" href="#id158" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.0: Initial version. strus38</p></li>
</ul>
</div>
</div>
<div class="section" id="sssd">
<h3><span class="section-number">11.3.16. </span>SSSD<a class="headerlink" href="#sssd" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id159">
<h4><span class="section-number">11.3.16.1. </span>Description<a class="headerlink" href="#id159" title="Permalink to this headline">¶</a></h4>
<p>This role provides a basic configuration of SSSD to connect to an LDAP client.</p>
</div>
<div class="section" id="id160">
<h4><span class="section-number">11.3.16.2. </span>Instructions<a class="headerlink" href="#id160" title="Permalink to this headline">¶</a></h4>
<p>LDAP servers URL must be configured in the inventory like the example below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">## List of logical networks</span>
<span class="nt">networks</span><span class="p">:</span>

  <span class="nt">ice1-1</span><span class="p">:</span>
    <span class="nt">subnet</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.0</span>
    <span class="nt">prefix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="nt">netmask</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">255.255.0.0</span>
    <span class="nt">broadcast</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.255.255</span>
    <span class="nt">dhcp_unknown_range</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.254.1 10.10.254.254</span>
    <span class="nt">gateway</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.2.1</span>
    <span class="nt">is_in_dhcp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">is_in_dns</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">services_ip</span><span class="p">:</span>
      <span class="nt">pxe_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">dns_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">repository_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">authentication_servers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ldaps://my-ldap-server-1</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ldap://my-ldap-server-2</span>
      <span class="nt">time_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
      <span class="nt">log_ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.10.0.1</span>
</pre></div>
</div>
<p>The following example configure LDAP secured server <em>my-ldap-server-1</em> as first server and <em>my-ldap-server-2</em> as second server.</p>
</div>
<div class="section" id="id161">
<h4><span class="section-number">11.3.16.3. </span>Changelog<a class="headerlink" href="#id161" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.2: Support multiple and secured connections to LDAP servers. &lt;<a class="reference external" href="mailto:mathis&#46;gavillon&#37;&#52;&#48;atos&#46;net">mathis<span>&#46;</span>gavillon<span>&#64;</span>atos<span>&#46;</span>net</a>&gt;</p></li>
<li><p>1.0.1: Fixed bad template. Documentation. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. oxedions &lt;<a class="reference external" href="mailto:oxedions&#37;&#52;&#48;gmail&#46;com">oxedions<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="slurm">
<h3><span class="section-number">11.3.17. </span>Slurm<a class="headerlink" href="#slurm" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id162">
<h4><span class="section-number">11.3.17.1. </span>Description<a class="headerlink" href="#id162" title="Permalink to this headline">¶</a></h4>
<p>This role provides slurm configuration for server, client and login nodes.</p>
</div>
<div class="section" id="id163">
<h4><span class="section-number">11.3.17.2. </span>Instructions<a class="headerlink" href="#id163" title="Permalink to this headline">¶</a></h4>
<p><strong>IMPORTANT</strong>: first thing to do is to generate a new munge key file. To do so,
go into files folder of the role and generate a new munge.key file using:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>dd if=/dev/urandom bs=1 count=1024 &gt; munge.key
</pre></div>
</div>
<p>We do not provide default munge key file, as it is considered a security risk.</p>
<p>Then, in the inventory addon folder (inventory/group_vars/all/addons) that should
be created if not exist, add a slurm.yml file with the following content, tuned
according to your needs:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">slurm</span><span class="p">:</span>
  <span class="nt">slurm_packaging</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">after_17</span> <span class="c1"># Can be before_17 or after_17. If using BlueBanquise packages, use after_17. For OpenHPC 1.3, use before_17.</span>
  <span class="nt">cluster_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bluebanquise</span>
  <span class="nt">control_machine</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">management1</span>
  <span class="nt">MpiDefault</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pmi2</span> <span class="c1"># Optional</span>
  <span class="nt">nodes_equipment_groups</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">equipment_typeC</span>
</pre></div>
</div>
<p>To use this role for all 3 types of nodes, simply add a vars in the playbook
when loading the role. Extra vars is <strong>slurm_profile</strong>.</p>
<p>For a controller (server), use:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">slurm</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">slurm</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">slurm_profile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">controller</span>
</pre></div>
</div>
<p>For a compute node (client), use:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">slurm</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">slurm</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">slurm_profile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node</span>
</pre></div>
</div>
<p>And for a login (passive client), use:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">slurm</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">slurm</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">slurm_profile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">passive</span>
</pre></div>
</div>
</div>
<div class="section" id="id164">
<h4><span class="section-number">11.3.17.3. </span>Input<a class="headerlink" href="#id164" title="Permalink to this headline">¶</a></h4>
<p>Mandatory inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>slurm_profile</p></li>
<li><dl class="simple">
<dt>slurm</dt><dd><ul>
<li><p>.cluster_name</p></li>
<li><p>.control_machine</p></li>
<li><p>.nodes_equipment_groups</p></li>
<li><p>.slurm_packaging</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>hostvars[hosts]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>ep_hardware</dt><dd><ul>
<li><dl class="simple">
<dt>.cpu</dt><dd><ul>
<li><p>.core</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>slurm</dt><dd><ul>
<li><p>.MpiDefault</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id165">
<h4><span class="section-number">11.3.17.4. </span>To be done<a class="headerlink" href="#id165" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>slurmdbd + mariadb</p></li>
<li><p>static file</p></li>
</ul>
</div>
<div class="section" id="id166">
<h4><span class="section-number">11.3.17.5. </span>Changelog<a class="headerlink" href="#id166" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.2: Update role, remove munge key. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="users-basic">
<h3><span class="section-number">11.3.18. </span>Users basic<a class="headerlink" href="#users-basic" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id167">
<h4><span class="section-number">11.3.18.1. </span>Description<a class="headerlink" href="#id167" title="Permalink to this headline">¶</a></h4>
<p>This role provides a very basic users management, for simple clusters.</p>
</div>
<div class="section" id="id168">
<h4><span class="section-number">11.3.18.2. </span>Instructions<a class="headerlink" href="#id168" title="Permalink to this headline">¶</a></h4>
<p>Create file inventory/group_vars/all/addons/users_basic.yml with the following content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">users_basic</span><span class="p">:</span>

  <span class="nt">users</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">johnnykeats</span>
      <span class="nt">uid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1078</span>
      <span class="nt">gid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1078</span>
      <span class="nt">home</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home</span>
      <span class="nt">shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
      <span class="nt">comment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dream all the day</span> <span class="c1"># optional</span>
      <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$6$M3crarMVoUV3rALd$ZTre2CIyss7zOb4lkLoG23As9OAkYPw2BM88Y1F43n8CCyV5XWwAYEwBOrS8bcCBIMjIPdJG.ndOfzWyAVR4j0</span>
</pre></div>
</div>
<p>Then edit this file according to your needs, and play this role on all hosts with users, including slurmctld server if using slurm.</p>
<p>Available arguments for each user are:</p>
<ul class="simple">
<li><p>name</p></li>
<li><p>uid</p></li>
<li><p>gid</p></li>
<li><p>password</p></li>
<li><p>state</p></li>
<li><p>groups (optional)</p></li>
<li><p>create_home (optional)</p></li>
<li><p>update_password (optional)</p></li>
<li><p>shell (optional)</p></li>
<li><p>home (optional)</p></li>
<li><p>generate_ssh_key (optional)</p></li>
<li><p>ssh_key_bits (optional)</p></li>
<li><p>ssh_key_file (optional)</p></li>
<li><p>remove (optional)</p></li>
<li><p>comment (optional)</p></li>
</ul>
<p>To ensure a user is not on a system, set state to “absent”. To also remove its
home, set remove to “yes”.</p>
<p>To generate an sha512 password, use the following command (python &gt;3.3):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -c <span class="s1">&#39;import crypt,getpass; print(crypt.crypt(getpass.getpass(), crypt.mksalt(crypt.METHOD_SHA512)))&#39;</span>
</pre></div>
</div>
<p>Or (python 2):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -c <span class="s2">&quot;import crypt,random,string; print crypt.crypt(raw_input(&#39;clear-text password: &#39;), &#39;\$6\$&#39; + &#39;&#39;.join([random.choice(string.ascii_letters + string.digits) for _ in range(16)]))&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id169">
<h4><span class="section-number">11.3.18.3. </span>Changelog<a class="headerlink" href="#id169" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.1.0: Role enhancement. New inventory structure. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.1: Documentation and resources. johnnykeats &lt;<a class="reference external" href="mailto:johnny&#46;keats&#37;&#52;&#48;outlook&#46;com">johnny<span>&#46;</span>keats<span>&#64;</span>outlook<span>&#46;</span>com</a>&gt;</p></li>
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
<div class="section" id="lmod">
<h3><span class="section-number">11.3.19. </span>lmod<a class="headerlink" href="#lmod" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id170">
<h4><span class="section-number">11.3.19.1. </span>Description<a class="headerlink" href="#id170" title="Permalink to this headline">¶</a></h4>
<p>This role simply install Lmod tool (<a class="reference external" href="https://lmod.readthedocs.io/">https://lmod.readthedocs.io/</a>) and
set custom path if needed.</p>
</div>
<div class="section" id="id171">
<h4><span class="section-number">11.3.19.2. </span>Instructions<a class="headerlink" href="#id171" title="Permalink to this headline">¶</a></h4>
<p>Note that Lmod is available on EPEL repository, and requires Centos PowerTools to
to get all dependencies.</p>
<p>If custom path are needed, define variable lmod_path, as a list, in the inventory.</p>
<p>For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">lmod_path</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/etc/modulefiles</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/soft/modules</span>
</pre></div>
</div>
<p>These will be added in file /etc/profile.d/modules_extra_path.sh, and so be available
to all users.</p>
<p>Optional inventory vars:</p>
<p><strong>hostvars[inventory_hostname]</strong></p>
<ul class="simple">
<li><p>lmod_path (list)</p></li>
</ul>
</div>
<div class="section" id="id172">
<h4><span class="section-number">11.3.19.3. </span>Output<a class="headerlink" href="#id172" title="Permalink to this headline">¶</a></h4>
<p>Packages installed:</p>
<ul class="simple">
<li><p>Lmod</p></li>
</ul>
<p>Files generated:</p>
<ul class="simple">
<li><p>/etc/profile.d/modules_extra_path.sh (optional)</p></li>
</ul>
</div>
<div class="section" id="id173">
<h4><span class="section-number">11.3.19.4. </span>Changelog<a class="headerlink" href="#id173" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>1.0.0: Role creation. Benoit Leveugle &lt;<a class="reference external" href="mailto:benoit&#46;leveugle&#37;&#52;&#48;gmail&#46;com">benoit<span>&#46;</span>leveugle<span>&#64;</span>gmail<span>&#46;</span>com</a>&gt;</p></li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="references.html" class="btn btn-neutral float-right" title="12. References" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="stories.html" class="btn btn-neutral float-left" title="10. Stories" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Benoît Leveugle, Johnny Keats

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>